<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FLUX 2 Prompt Node v2 - ComfyUI Style</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Custom Scrollbar - Webkit (Chrome, Safari, Edge) */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: #1a1a2e;
      border-radius: 5px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #7c3aed 0%, #5b21b6 100%);
      border-radius: 5px;
      border: 2px solid #1a1a2e;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #8b5cf6 0%, #6d28d9 100%);
    }

    ::-webkit-scrollbar-corner {
      background: #1a1a2e;
    }

    /* Custom Scrollbar - Firefox */
    * {
      scrollbar-width: thin;
      scrollbar-color: #7c3aed #1a1a2e;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: #1a1a1a;
      background-image: 
        radial-gradient(circle at 1px 1px, #333 1px, transparent 0);
      background-size: 20px 20px;
      min-height: 100vh;
      padding: 40px;
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
      align-items: flex-start;
      justify-content: center;
    }

    .node {
      background: #2a2a2a;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      min-width: 380px;
      max-width: 420px;
      overflow: hidden;
    }

    .node-header {
      background: linear-gradient(135deg, #5a4fcf 0%, #7c3aed 100%);
      padding: 10px 14px;
      font-weight: 600;
      font-size: 13px;
      color: white;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .node-header-icon {
      width: 18px;
      height: 18px;
      background: rgba(255,255,255,0.2);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }

    .node-body {
      padding: 12px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .field-group {
      margin-bottom: 12px;
    }

    .field-label {
      font-size: 11px;
      color: #888;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .field-label .hint {
      font-size: 10px;
      color: #666;
      text-transform: none;
      letter-spacing: 0;
    }

    .field-input {
      width: 100%;
      background: #1e1e1e;
      border: 1px solid #3a3a3a;
      border-radius: 4px;
      padding: 8px 10px;
      color: #e0e0e0;
      font-size: 12px;
      transition: border-color 0.2s;
    }

    .field-input:focus {
      outline: none;
      border-color: #7c3aed;
    }

    .field-input::placeholder {
      color: #555;
    }

    textarea.field-input {
      min-height: 80px;
      resize: vertical;
      font-family: inherit;
      line-height: 1.5;
    }

    select.field-input {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      padding-right: 30px;
    }

    .sub-section {
      background: #252525;
      border-radius: 6px;
      padding: 10px;
      margin-top: 8px;
    }

    .sub-section-title {
      font-size: 11px;
      color: #7c3aed;
      font-weight: 600;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .sub-section-title::before {
      content: '';
      width: 8px;
      height: 8px;
      background: #7c3aed;
      border-radius: 2px;
    }

    .inline-fields {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .inline-fields.three {
      grid-template-columns: 1fr 1fr 1fr;
    }

    .inline-fields.four {
      grid-template-columns: 1fr 1fr 1fr 1fr;
    }

    .color-palette {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }

    .color-chip {
      display: flex;
      align-items: center;
      gap: 6px;
      background: #1e1e1e;
      border: 1px solid #3a3a3a;
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 11px;
      color: #ccc;
    }

    .color-chip input[type="text"] {
      background: transparent;
      border: none;
      color: #e0e0e0;
      width: 100px;
      font-size: 11px;
    }

    .color-chip input[type="text"]:focus {
      outline: none;
    }

    .color-chip .remove-btn {
      background: none;
      border: none;
      color: #666;
      cursor: pointer;
      font-size: 14px;
      line-height: 1;
      padding: 0 2px;
    }

    .color-chip .remove-btn:hover {
      color: #ff6b6b;
    }

    .color-chip input[type="color"] {
      width: 20px;
      height: 20px;
      padding: 0;
      border: 1px solid #555;
      border-radius: 3px;
      cursor: pointer;
      background: transparent;
    }

    .color-chip input[type="color"]::-webkit-color-swatch-wrapper {
      padding: 0;
    }

    .color-chip input[type="color"]::-webkit-color-swatch {
      border: none;
      border-radius: 2px;
    }

    .color-chip .eyedropper-btn {
      background: #333;
      border: 1px solid #555;
      border-radius: 3px;
      width: 22px;
      height: 22px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: #ccc;
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .color-chip .eyedropper-btn:hover:not(:disabled) {
      background: #444;
      border-color: #7c3aed;
      color: #fff;
    }

    .color-chip .eyedropper-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .color-chip .eyedropper-btn svg {
      width: 12px;
      height: 12px;
      pointer-events: none;
    }

    /* Style selector with edit toggle */
    .style-selector {
      display: flex;
      gap: 4px;
    }

    .style-selector .style-dropdown {
      flex: 1;
    }

    .style-selector .style-text {
      flex: 1;
      display: none;
    }

    .style-selector.edit-mode .style-dropdown {
      display: none;
    }

    .style-selector.edit-mode .style-text {
      display: block;
    }

    .style-selector .edit-toggle {
      background: #333;
      border: 1px solid #555;
      border-radius: 4px;
      width: 32px;
      height: 32px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #888;
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .style-selector .edit-toggle:hover {
      background: #444;
      border-color: #7c3aed;
      color: #ccc;
    }

    .style-selector.edit-mode .edit-toggle {
      background: #7c3aed;
      border-color: #7c3aed;
      color: white;
    }

    .style-selector .edit-toggle svg {
      width: 14px;
      height: 14px;
      pointer-events: none;
    }

    .style-dropdown optgroup {
      background: #1e1e1e;
      color: #888;
      font-style: normal;
      font-weight: 600;
    }

    .style-dropdown option {
      background: #1e1e1e;
      color: #e0e0e0;
      padding: 4px;
    }

    /* Image picker section */
    .image-picker-section {
      margin-bottom: 12px;
    }

    .image-drop-zone {
      position: relative;
      background: #1a1a1a;
      border: 2px dashed #444;
      border-radius: 6px;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      overflow: hidden;
    }

    .image-drop-zone:hover {
      border-color: #7c3aed;
      background: #1e1e2a;
    }

    .image-drop-zone.drag-over {
      border-color: #7c3aed;
      background: #252535;
      border-style: solid;
    }

    .image-drop-zone.has-image {
      cursor: crosshair;
      border-style: solid;
      border-color: #3a3a3a;
    }

    .image-drop-zone.has-image:hover {
      border-color: #7c3aed;
    }

    .drop-zone-content {
      text-align: center;
      padding: 20px;
    }

    .drop-icon {
      font-size: 32px;
      margin-bottom: 8px;
    }

    .drop-text {
      font-size: 12px;
      color: #888;
      margin-bottom: 4px;
    }

    .drop-hint {
      font-size: 10px;
      color: #555;
    }

    #image-canvas {
      display: none;
      max-width: 100%;
      max-height: 300px;
      border-radius: 4px;
    }

    .image-drop-zone.has-image #image-canvas {
      display: block;
    }

    .image-drop-zone.has-image .drop-zone-content {
      display: none;
    }

    .clear-image-btn {
      position: absolute;
      top: 6px;
      right: 6px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid #555;
      color: #ccc;
      font-size: 16px;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      line-height: 1;
    }

    .clear-image-btn:hover {
      background: #ff4444;
      border-color: #ff4444;
      color: white;
    }

    .image-drop-zone.has-image .clear-image-btn {
      display: flex;
    }

    .picked-color-preview {
      display: none;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
      padding: 8px;
      background: #1e1e1e;
      border: 1px solid #3a3a3a;
      border-radius: 4px;
    }

    .picked-color-preview.visible {
      display: flex;
    }

    .preview-swatch {
      width: 28px;
      height: 28px;
      border-radius: 4px;
      border: 2px solid #555;
      background: #000;
      flex-shrink: 0;
    }

    .picked-color-preview span {
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      color: #ccc;
      flex: 1;
    }

    .add-color-btn {
      background: #333;
      border: 1px dashed #555;
      border-radius: 4px;
      padding: 4px 10px;
      font-size: 11px;
      color: #888;
      cursor: pointer;
      transition: all 0.2s;
    }

    .add-color-btn:hover {
      background: #3a3a3a;
      border-color: #7c3aed;
      color: #aaa;
    }

    /* Combo input (select + text) */
    .combo-input {
      position: relative;
    }

    .combo-input input {
      padding-right: 30px;
    }

    .combo-input .dropdown-toggle {
      position: absolute;
      right: 1px;
      top: 1px;
      bottom: 1px;
      width: 28px;
      background: #2a2a2a;
      border: none;
      border-left: 1px solid #3a3a3a;
      border-radius: 0 3px 3px 0;
      cursor: pointer;
      color: #888;
      font-size: 10px;
    }

    .combo-input .dropdown-toggle:hover {
      background: #333;
      color: #aaa;
    }

    .combo-input .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #1e1e1e;
      border: 1px solid #3a3a3a;
      border-radius: 4px;
      margin-top: 2px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 100;
      display: none;
    }

    .combo-input .dropdown-menu.open {
      display: block;
    }

    .combo-input .dropdown-menu .option {
      padding: 6px 10px;
      font-size: 11px;
      color: #ccc;
      cursor: pointer;
    }

    .combo-input .dropdown-menu .option:hover {
      background: #2a2a2a;
      color: #fff;
    }

    .combo-input .dropdown-menu .option-header {
      padding: 4px 10px;
      font-size: 10px;
      color: #666;
      text-transform: uppercase;
      background: #252525;
      pointer-events: none;
    }

    /* Output node */
    .output-node .node-header {
      background: linear-gradient(135deg, #2d8a4e 0%, #22c55e 100%);
    }

    .json-output {
      background: #0d0d0d;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 12px;
      font-family: 'Fira Code', 'Consolas', monospace;
      font-size: 11px;
      color: #a0e0a0;
      white-space: pre-wrap;
      word-break: break-word;
      max-height: 600px;
      overflow-y: auto;
      line-height: 1.6;
    }

    .json-output .key {
      color: #9cdcfe;
    }

    .json-output .string {
      color: #ce9178;
    }

    .json-output .number {
      color: #b5cea8;
    }

    .copy-btn {
      width: 100%;
      background: linear-gradient(135deg, #2d8a4e 0%, #22c55e 100%);
      border: none;
      border-radius: 4px;
      padding: 10px;
      color: white;
      font-weight: 600;
      font-size: 12px;
      cursor: pointer;
      margin-top: 10px;
      transition: transform 0.1s, box-shadow 0.2s;
    }

    .copy-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
    }

    .copy-btn:active {
      transform: translateY(0);
    }

    .copy-btn.copied {
      background: #666;
    }

    /* Connection line visual */
    .connection-wrapper {
      display: flex;
      align-items: center;
      gap: 0;
    }

    .connection-line {
      width: 40px;
      height: 3px;
      background: linear-gradient(90deg, #7c3aed, #22c55e);
      position: relative;
    }

    .connection-line::before,
    .connection-line::after {
      content: '';
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      top: 50%;
      transform: translateY(-50%);
    }

    .connection-line::before {
      left: -5px;
      background: #7c3aed;
    }

    .connection-line::after {
      right: -5px;
      background: #22c55e;
    }

    .node-wrapper {
      position: relative;
    }

    .node-wrapper .socket-output {
      position: absolute;
      right: -6px;
      top: 50%;
      transform: translateY(-50%);
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #7c3aed;
      border: 2px solid #2a2a2a;
    }

    .node-wrapper .socket-input {
      position: absolute;
      left: -6px;
      top: 50%;
      transform: translateY(-50%);
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #22c55e;
      border: 2px solid #2a2a2a;
    }

    /* Preset dropdown */
    .preset-section {
      margin-bottom: 15px;
      padding-bottom: 12px;
      border-bottom: 1px solid #3a3a3a;
    }

    /* Toggle switch */
    .toggle-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 0;
    }

    .toggle-label {
      font-size: 11px;
      color: #aaa;
    }

    .toggle-switch {
      position: relative;
      width: 36px;
      height: 20px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #444;
      transition: 0.3s;
      border-radius: 20px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 14px;
      width: 14px;
      left: 3px;
      bottom: 3px;
      background-color: #888;
      transition: 0.3s;
      border-radius: 50%;
    }

    .toggle-switch input:checked + .toggle-slider {
      background-color: #7c3aed;
    }

    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(16px);
      background-color: white;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 2px;
      margin-bottom: 10px;
    }

    .tab {
      flex: 1;
      padding: 8px;
      background: #1e1e1e;
      border: none;
      color: #888;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .tab:first-child {
      border-radius: 4px 0 0 4px;
    }

    .tab:last-child {
      border-radius: 0 4px 4px 0;
    }

    .tab.active {
      background: #7c3aed;
      color: white;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    @media (max-width: 900px) {
      body {
        flex-direction: column;
        align-items: center;
      }
      .connection-line {
        display: none;
      }
    }
  </style>
</head>
<body>

  <div class="node-wrapper">
    <div class="node" id="prompt-node">
      <div class="node-header">
        <div class="node-header-icon">‚ú®</div>
        FLUX 2 Prompt Builder v2
      </div>
      <div class="node-body">
        
        <div class="preset-section">
          <div class="field-group">
            <div class="field-label">Load Preset</div>
            <select class="field-input" id="preset-select">
              <option value="">‚Äî Select a preset ‚Äî</option>
              <optgroup label="People & Portraits">
                <option value="intimate">Intimate Portrait</option>
                <option value="boudoir">Boudoir / Fine Art</option>
                <option value="portrait">Documentary Portrait</option>
                <option value="fashion">Fashion Editorial</option>
              </optgroup>
              <optgroup label="Nature & Outdoors">
                <option value="landscape">Landscape</option>
                <option value="wildlife">Wildlife</option>
                <option value="macro">Macro Nature</option>
                <option value="underwater">Underwater</option>
                <option value="astro">Astrophotography</option>
              </optgroup>
              <optgroup label="Action & Events">
                <option value="sports">Sports / Action</option>
                <option value="street">Street Photography</option>
                <option value="theatrical">Theatrical Performance</option>
                <option value="culinary">Culinary Action</option>
              </optgroup>
              <optgroup label="Commercial & Product">
                <option value="product">Product Photography</option>
                <option value="automotive">Automotive</option>
                <option value="architectural">Architectural</option>
              </optgroup>
              <optgroup label="Artistic & Stylized">
                <option value="cinematic">Cinematic / Film Noir</option>
                <option value="vintage">Vintage / Retro</option>
                <option value="minimalist">Minimalist</option>
              </optgroup>
              <optgroup label="Adult (18+)">
                <option value="nsfw">NSFW / Artistic Nude</option>
              </optgroup>
            </select>
          </div>
        </div>

        <div class="field-group">
          <div class="field-label">Main Prompt</div>
          <textarea class="field-input" id="prompt" placeholder="Describe your scene in detail..."></textarea>
        </div>

        <div class="field-group">
          <div class="field-label">Style</div>
          <div class="style-selector" id="style-selector">
            <select class="field-input style-dropdown" id="style-dropdown">
              <option value="">‚Äî Select a style ‚Äî</option>
            </select>
            <input type="text" class="field-input style-text" id="style" placeholder="e.g., photorealistic, cinematic lighting, editorial fashion">
            <button class="edit-toggle" id="style-edit-toggle" title="Edit raw style text">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
                <path d="m15 5 4 4"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="sub-section">
          <div class="sub-section-title">Camera Settings</div>
          
          <div class="inline-fields" style="margin-bottom: 8px;">
            <div class="field-group">
              <div class="field-label">Angle</div>
              <div class="combo-input">
                <input type="text" class="field-input" id="camera-angle" placeholder="eye level">
                <button class="dropdown-toggle" data-target="angle-menu">‚ñº</button>
                <div class="dropdown-menu" id="angle-menu">
                  <div class="option-header">Common Angles</div>
                  <div class="option" data-value="eye level">eye level (natural)</div>
                  <div class="option" data-value="low angle">low angle (powerful)</div>
                  <div class="option" data-value="high angle">high angle (diminishing)</div>
                  <div class="option" data-value="bird's-eye">bird's-eye (architectural)</div>
                  <div class="option" data-value="worm's-eye">worm's-eye (dramatic)</div>
                  <div class="option-header">Subtle Variations</div>
                  <div class="option" data-value="slightly low">slightly low</div>
                  <div class="option" data-value="slightly high">slightly high</div>
                  <div class="option-header">Creative Angles</div>
                  <div class="option" data-value="Dutch angle">Dutch angle (tilted)</div>
                  <div class="option" data-value="over-the-shoulder">over-the-shoulder (intimate)</div>
                  <div class="option" data-value="overhead flat lay">overhead flat lay</div>
                  <div class="option" data-value="ground level">ground level</div>
                  <div class="option" data-value="dynamic angle">dynamic angle</div>
                </div>
              </div>
            </div>
            <div class="field-group">
              <div class="field-label">Shot / Distance</div>
              <div class="combo-input">
                <input type="text" class="field-input" id="camera-shot" placeholder="medium shot">
                <button class="dropdown-toggle" data-target="shot-menu">‚ñº</button>
                <div class="dropdown-menu" id="shot-menu">
                  <div class="option-header">Standard Shots</div>
                  <div class="option" data-value="extreme close-up">extreme close-up</div>
                  <div class="option" data-value="close-up">close-up</div>
                  <div class="option" data-value="medium close-up">medium close-up</div>
                  <div class="option" data-value="medium shot">medium shot</div>
                  <div class="option" data-value="medium full shot">medium full shot</div>
                  <div class="option" data-value="full body">full body</div>
                  <div class="option" data-value="wide shot">wide shot</div>
                  <div class="option-header">Specialized</div>
                  <div class="option" data-value="macro detail">macro detail</div>
                  <div class="option" data-value="tight detail">tight detail</div>
                  <div class="option" data-value="product close-up">product close-up</div>
                  <div class="option" data-value="intimate close-up">intimate close-up</div>
                  <div class="option-header">Motion Shots</div>
                  <div class="option" data-value="tracking shot">tracking shot</div>
                  <div class="option" data-value="action shot">action shot</div>
                  <div class="option" data-value="full body action">full body action</div>
                </div>
              </div>
            </div>
          </div>

          <div class="inline-fields" style="margin-bottom: 8px;">
            <div class="field-group">
              <div class="field-label">Lens (mm)</div>
              <div class="combo-input">
                <input type="text" class="field-input" id="camera-lens" placeholder="50mm">
                <button class="dropdown-toggle" data-target="lens-menu">‚ñº</button>
                <div class="dropdown-menu" id="lens-menu">
                  <div class="option-header">Wide (Dramatic)</div>
                  <div class="option" data-value="14mm">14mm (ultra-wide)</div>
                  <div class="option" data-value="24mm">24mm (wide)</div>
                  <div class="option" data-value="28mm">28mm (wide)</div>
                  <div class="option-header">Natural</div>
                  <div class="option" data-value="35mm">35mm (natural)</div>
                  <div class="option" data-value="50mm">50mm (standard)</div>
                  <div class="option-header">Portrait / Telephoto</div>
                  <div class="option" data-value="70mm">70mm</div>
                  <div class="option" data-value="85mm">85mm (portrait)</div>
                  <div class="option" data-value="100mm">100mm</div>
                  <div class="option" data-value="135mm">135mm (telephoto)</div>
                  <div class="option" data-value="200mm">200mm (telephoto)</div>
                  <div class="option-header">Specialty</div>
                  <div class="option" data-value="100mm macro">100mm macro</div>
                  <div class="option" data-value="fisheye">fisheye</div>
                  <div class="option" data-value="tilt-shift">tilt-shift</div>
                </div>
              </div>
            </div>
            <div class="field-group">
              <div class="field-label">Aperture (f-stop)</div>
              <div class="combo-input">
                <input type="text" class="field-input" id="camera-aperture" placeholder="f/2.8">
                <button class="dropdown-toggle" data-target="aperture-menu">‚ñº</button>
                <div class="dropdown-menu" id="aperture-menu">
                  <div class="option-header">Shallow DOF (Blurred BG)</div>
                  <div class="option" data-value="f/1.2">f/1.2 (very shallow)</div>
                  <div class="option" data-value="f/1.4">f/1.4 (shallow)</div>
                  <div class="option" data-value="f/1.8">f/1.8</div>
                  <div class="option" data-value="f/2.0">f/2.0</div>
                  <div class="option" data-value="f/2.8">f/2.8 (portrait)</div>
                  <div class="option-header">Moderate DOF</div>
                  <div class="option" data-value="f/4">f/4</div>
                  <div class="option" data-value="f/5.6">f/5.6 (balanced)</div>
                  <div class="option-header">Deep DOF (Sharp BG)</div>
                  <div class="option" data-value="f/8">f/8 (landscape)</div>
                  <div class="option" data-value="f/11">f/11 (sharp)</div>
                  <div class="option" data-value="f/16">f/16 (deep focus)</div>
                </div>
              </div>
            </div>
          </div>

          <div class="inline-fields">
            <div class="field-group">
              <div class="field-label">ISO</div>
              <div class="combo-input">
                <input type="text" class="field-input" id="camera-iso" placeholder="100">
                <button class="dropdown-toggle" data-target="iso-menu">‚ñº</button>
                <div class="dropdown-menu" id="iso-menu">
                  <div class="option-header">Low (Clean)</div>
                  <div class="option" data-value="100">100 (cleanest)</div>
                  <div class="option" data-value="200">200</div>
                  <div class="option" data-value="400">400</div>
                  <div class="option-header">Medium</div>
                  <div class="option" data-value="800">800</div>
                  <div class="option" data-value="1600">1600</div>
                  <div class="option-header">High (Grainy)</div>
                  <div class="option" data-value="3200">3200 (noisy)</div>
                  <div class="option" data-value="6400">6400 (grainy)</div>
                </div>
              </div>
            </div>
            <div class="field-group">
              <div class="field-label">Focus Description</div>
              <input type="text" class="field-input" id="camera-focus" placeholder="Sharp focus on subject">
            </div>
          </div>

          <div class="field-group" style="margin-top: 8px;">
            <div class="field-label">Camera / Film Stock <span class="hint">(optional, for authenticity)</span></div>
            <div class="style-selector" id="camera-selector">
              <select class="field-input style-dropdown" id="camera-dropdown">
                <option value="">‚Äî Select camera/lens ‚Äî</option>
              </select>
              <input type="text" class="field-input style-text" id="camera-model" placeholder="e.g., Shot on Fujifilm X-T5, Kodak Portra 400">
              <button class="edit-toggle" id="camera-edit-toggle" title="Edit raw camera text">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
                  <path d="m15 5 4 4"/>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <div class="sub-section">
          <div class="sub-section-title">Lighting</div>
          <div class="field-group">
            <div class="style-selector" id="lighting-selector">
              <select class="field-input style-dropdown" id="lighting-dropdown">
                <option value="">‚Äî Select lighting ‚Äî</option>
              </select>
              <input type="text" class="field-input style-text" id="lighting" placeholder="e.g., Three-point softbox, golden hour, dramatic chiaroscuro">
              <button class="edit-toggle" id="lighting-edit-toggle" title="Edit raw lighting text">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
                  <path d="m15 5 4 4"/>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <div class="sub-section">
          <div class="sub-section-title">Color Palette</div>

          <div class="image-picker-section">
            <div class="image-drop-zone" id="image-drop-zone">
              <div class="drop-zone-content" id="drop-zone-content">
                <div class="drop-icon">üñºÔ∏è</div>
                <div class="drop-text">Drop image here or click to upload</div>
                <div class="drop-hint">Click on image to pick colors (no SSL required)</div>
              </div>
              <canvas id="image-canvas"></canvas>
              <button class="clear-image-btn" id="clear-image" title="Clear image">√ó</button>
            </div>
            <input type="file" id="image-input" accept="image/*" style="display: none;">
            <div class="picked-color-preview" id="picked-color-preview">
              <div class="preview-swatch" id="preview-swatch"></div>
              <span id="preview-hex">Click image to add color</span>
            </div>
          </div>

          <div class="color-palette" id="color-palette"></div>
          <button class="add-color-btn" id="add-color">+ Add Color</button>
          
          <div class="field-group" style="margin-top: 12px;">
            <div class="field-label">Mood</div>
            <div class="style-selector" id="mood-selector">
              <select class="field-input style-dropdown" id="mood-dropdown">
                <option value="">‚Äî Select mood ‚Äî</option>
              </select>
              <input type="text" class="field-input style-text" id="color-mood" placeholder="e.g., moody yet vibrant, urban elegance">
              <button class="edit-toggle" id="mood-edit-toggle" title="Edit raw mood text">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <div class="sub-section">
          <div class="sub-section-title">Composition</div>
          <div class="style-selector" id="composition-selector">
            <select class="field-input style-dropdown" id="composition-dropdown">
              <option value="">‚Äî Select composition ‚Äî</option>
            </select>
            <input type="text" class="field-input style-text" id="composition" placeholder="rule of thirds, leading lines">
            <button class="edit-toggle" id="composition-edit-toggle" title="Edit raw composition text">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
              </svg>
            </button>
          </div>
        </div>

        <div class="sub-section">
          <div class="sub-section-title">Output Options</div>
          <div class="toggle-row">
            <span class="toggle-label">Include empty fields</span>
            <label class="toggle-switch">
              <input type="checkbox" id="include-empty">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="toggle-row">
            <span class="toggle-label">Numeric lens-mm format</span>
            <label class="toggle-switch">
              <input type="checkbox" id="numeric-lens" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

      </div>
    </div>
    <div class="socket-output"></div>
  </div>

  <div class="connection-line"></div>

  <div class="node-wrapper">
    <div class="node output-node">
      <div class="node-header">
        <div class="node-header-icon">üìã</div>
        JSON Output
      </div>
      <div class="node-body">
        <div class="json-output" id="json-output"></div>
        <button class="copy-btn" id="copy-btn">Copy to Clipboard</button>
      </div>
    </div>
    <div class="socket-input"></div>
  </div>

  <script>
    // State
    let colors = ['#2A5BDA', 'amber glow'];

    // Presets
    const presets = {
      intimate: {
        prompt: "An intimate close-up portrait of two lovers in soft embrace, faces nearly touching, eyes closed in tender moment, delicate skin textures and subtle expressions visible, shot in available window light with gossamer curtains diffusing the glow, creating an atmosphere of vulnerability and connection.",
        style: "black and white photography, timeless elegance, classic aesthetic, dramatic contrasts, emphasizing shapes and textures, evoking nostalgia, focusing on light and shadow, monochromatic storytelling, capturing mood and emotion, artistic expression, minimalist compositions, conveying depth and atmosphere, timeless beauty",
        camera: { angle: "eye level", shot: "close-up detail", lens: "85mm", aperture: "f/1.4", iso: "400", focus: "Sharp focus on eyes and lips, soft falloff", model: "shot on Sony A7 IV with an 85mm f/1.4 G Master portrait lens" },
        lighting: "natural window light, soft diffused natural light, no harsh shadows, even illumination",
        colors: { palette: ["#E8D5C4", "#FFFFF0", "#36454F", "#FFFDD0"], mood: "romantic mood, intimate atmosphere, tender emotion, love and passion" },
        composition: "portrait composition, face fills frame, intimate connection, eye contact"
      },
      boudoir: {
        prompt: "An elegant boudoir portrait of a woman draped in silk sheets on a vintage brass bed, soft morning light streaming through sheer curtains, creating delicate shadows across the fabric folds, confident and empowered pose with artistic sensuality, warm skin tones against cool linen textures.",
        style: "fine art photography, conceptual expression, evocative imagery, artistic interpretation, emotional resonance, creative composition, professional lighting, exquisite detail, immersive experience, storytelling through imagery, conveying mood, unique perspective, thought-provoking concept, capturing beauty, transcending reality",
        camera: { angle: "slightly high", shot: "medium full shot", lens: "50mm", aperture: "f/1.8", iso: "200", focus: "Sharp on subject's face, dreamy background blur", model: "shot on Canon EOS R5 with an 85mm f/1.2 portrait lens" },
        lighting: "natural window light, soft directional lighting, gentle shadows",
        colors: { palette: ["#FFFFF0", "#B5A642", "#FFCBA4", "#4682B4"], mood: "elegant mood, luxurious atmosphere, refined aesthetic, sophisticated feel" },
        composition: "environmental portrait composition, subject in context, story-telling background"
      },
      fashion: {
        prompt: "A young female fashion designer wearing a tailored cobalt-blue blazer with #2A5BDA accents stands confidently on a rain-drenched Parisian street at dusk, neon signs reflecting off wet cobblestones, adjusting her glasses as she sketches in a leather-bound notebook, with soft golden light from caf√© windows casting long, realistic shadows and precise fabric folds visible under ambient street lamps.",
        style: "fashion photography, glamorous, stylish attire, captivating pose, dynamic composition, high-fashion aesthetic, professional studio lighting, expert styling, showcasing trend, conveying elegance, conveying attitude, evoking emotion, creating visual impact, editorial storytelling, artistic interpretation, fashion-forward visual",
        camera: { angle: "eye level", shot: "medium full shot", lens: "35mm", aperture: "f/2.8", iso: "400", focus: "Sharp focus on subject and fabric details", model: "shot on Sony A7 IV with a 35mm f/1.4 G Master lens" },
        lighting: "mixed warm and cool lighting, color contrast, orange and blue tones",
        colors: { palette: ["#2A5BDA", "#FFBF00", "#4A4A4A", "#FF69B4"], mood: "urban elegance, city sophistication, metropolitan mood, stylish street atmosphere" },
        composition: "rule of thirds composition, subject off-center, balanced visual weight"
      },
      portrait: {
        prompt: "A weathered fisherman with deep-set eyes and salt-and-pepper beard sits on a wooden dock at dawn, his calloused hands wrapped around a steaming cup of coffee, morning mist rolling across the harbor behind him, authentic wrinkles and skin texture visible in the soft directional light.",
        style: "documentary photography, capturing reality, social issues, human experiences, photojournalistic storytelling, candid moments, authentic narratives, raising awareness, documenting history, preserving cultural heritage, immersive storytelling, evoking empathy, powerful imagery, journalistic integrity",
        camera: { angle: "eye level", shot: "medium close-up", lens: "85mm", aperture: "f/1.8", iso: "200", focus: "Sharp focus on eyes", model: "shot on Canon EOS 5D Mark IV with a 50mm f/1.2 lens" },
        lighting: "golden hour lighting, warm sunlight, long shadows, soft golden glow",
        colors: { palette: ["#8B4513", "#4169E1", "#B0C4DE", "#D2691E"], mood: "moody atmosphere, emotional depth, contemplative feeling, evocative imagery" },
        composition: "rule of thirds composition, subject off-center, balanced visual weight"
      },
      landscape: {
        prompt: "A majestic mountain range at golden hour with a pristine alpine lake in the foreground reflecting snow-capped peaks, wildflowers dotting the meadow, layers of atmospheric haze creating depth, and dramatic clouds catching the warm sunset light across the vast wilderness panorama.",
        style: "landscape photography, vast vistas, natural beauty, dynamic compositions, captivating scenery, immersive, serene",
        camera: { angle: "eye level", shot: "wide shot", lens: "16mm", aperture: "f/11", iso: "100", focus: "Deep focus throughout, hyperfocal distance", model: "shot on Nikon Z8 with a 50mm f/1.2 lens" },
        lighting: "golden hour lighting, warm sunlight, long shadows, soft golden glow",
        colors: { palette: ["#4682B4", "#FFFAFA", "#FF8C00", "#228B22", "#9370DB"], mood: "serene atmosphere, peaceful mood, calm tranquility, meditative feeling" },
        composition: "foreground interest composition, layered depth, near and far elements"
      },
      street: {
        prompt: "A candid moment on a bustling Tokyo street at night, a salary man in a crisp suit checking his phone under the glow of neon signs and paper lanterns, steam rising from a nearby ramen stall, rain-slicked pavement reflecting the colorful lights, authentic urban energy captured in a decisive moment.",
        style: "documentary photography, capturing reality, social issues, human experiences, photojournalistic storytelling, candid moments, authentic narratives, raising awareness, documenting history, preserving cultural heritage, immersive storytelling, evoking empathy, powerful imagery, journalistic integrity",
        camera: { angle: "eye level", shot: "medium shot", lens: "35mm", aperture: "f/8", iso: "1600", focus: "Zone focus, everything sharp from 2m to infinity", model: "shot on Leica M10 with a 35mm f/1.4 Summilux lens" },
        lighting: "neon lighting, vibrant colored lights, cyberpunk aesthetic, urban night scene",
        colors: { palette: ["#FF1493", "#00BFFF", "#FF6600", "#3D3D3D"], mood: "urban elegance, city sophistication, metropolitan mood, stylish street atmosphere" },
        composition: "candid composition, unposed moment, authentic documentary style"
      },
      wildlife: {
        prompt: "A magnificent African lion with a golden mane rests on a rocky outcrop at sunset in the Serengeti, piercing amber eyes gazing directly at the camera, every whisker and fur detail visible, acacia trees silhouetted against the orange sky, dust particles catching the warm backlight.",
        style: "landscape photography, vast vistas, natural beauty, dynamic compositions, captivating scenery, immersive, serene",
        camera: { angle: "eye level", shot: "medium close-up", lens: "400mm", aperture: "f/5.6", iso: "800", focus: "Tack sharp on eyes, creamy background bokeh", model: "shot on Sony Alpha 1 with a 50mm f/1.2 G Master lens" },
        lighting: "backlit subject, rim lighting, sun behind subject, glowing edges, lens flare",
        colors: { palette: ["#DAA520", "#FF4500", "#C4A747", "#1C1C1C"], mood: "intense atmosphere, dramatic mood, powerful emotion, high stakes feeling" },
        composition: "rule of thirds composition, subject off-center, balanced visual weight"
      },
      astro: {
        prompt: "The Milky Way galaxy arching over a lone ancient bristlecone pine tree on a remote mountain peak, countless stars and nebulae visible in the pristine dark sky, subtle airglow on the horizon, the tree's twisted silhouette contrasting against the cosmic display.",
        style: "landscape photography, vast vistas, natural beauty, dynamic compositions, captivating scenery, immersive, serene",
        camera: { angle: "low angle", shot: "ultra wide shot", lens: "14mm", aperture: "f/1.8", iso: "3200", focus: "Manual focus at infinity for stars", model: "shot on Sony A7S III with a 24mm f/1.4 low-light lens" },
        lighting: "moonlight illumination, cool blue tones, nighttime ambiance, soft silver light",
        colors: { palette: ["#191970", "#C0C0C0", "#8A2BE2", "#FFFFFF", "#DAA520"], mood: "mysterious atmosphere, enigmatic mood, intriguing shadows, sense of wonder" },
        composition: "leading lines composition, lines guide viewer's eye to subject"
      },
      sports: {
        prompt: "A professional basketball player frozen mid-dunk, muscles tensed in peak athletic form, sweat droplets suspended in the arena lights, crowd blurred in the background, dramatic rim-level perspective capturing the power and grace of the decisive moment.",
        style: "Cinematic photography, movie mood, cinematic light, compelling composition, storytelling elements, conveys emotion, mood, and narrative depth, creating visually striking images that feel like still frames from a film",
        camera: { angle: "low angle", shot: "action medium shot", lens: "70mm", aperture: "f/2.8", iso: "3200", focus: "Sharp on athlete, motion frozen", model: "shot on Canon EOS R5 with a 24-70mm f/2.8 zoom lens" },
        lighting: "stage lighting, dramatic spotlights, performance lighting, theatrical",
        colors: { palette: ["#FF4500", "#CC0000", "#D2B48C", "#FFFFFF"], mood: "intense atmosphere, dramatic mood, powerful emotion, high stakes feeling" },
        composition: "action composition, motion blur, dynamic movement, peak moment"
      },
      product: {
        prompt: "A robotic arm with brushed aluminum joints precisely places a glowing red apple onto a minimalist white countertop under studio lighting, the apple's skin showing subtle subsurface scattering and dewy condensation, with crisp reflections of overhead LEDs on the metal surface and the background softly blurred to emphasize depth and material accuracy.",
        style: "food photography, mouthwatering dishes, vibrant colors, appetizing presentations, enticing compositions, delicious details, showcasing textures, capturing freshness, professional lighting, expert styling, culinary storytelling, enhancing food appeal",
        camera: { angle: "slightly high", shot: "close-up detail", lens: "90mm", aperture: "f/8", iso: "100", focus: "Sharp focus throughout product", model: "shot on Hasselblad X1D II 50C with a 65mm f/2.8 medium-format lens" },
        lighting: "softbox lighting, soft diffused light, minimal shadows, even skin tones",
        colors: { palette: ["#A8A9AD", "#DC143C", "#FFFFFF", "#4682B4"], mood: "modern aesthetic, sleek and contemporary, minimalist mood, clean design" },
        composition: "product composition, item centered, clean background, commercial appeal"
      },
      automotive: {
        prompt: "A luxury electric car with matte-black paint and neon-green #39FF14 brake calipers accelerates through a desert highway at golden hour, kicking up fine dust that catches the low-angle sunlight, with accurate tire deformation, realistic glass reflections of distant mesas, and flawless rendering of the car's logo and dashboard text visible through the windshield.",
        style: "Cinematic photography, movie mood, cinematic light, compelling composition, storytelling elements, conveys emotion, mood, and narrative depth, creating visually striking images that feel like still frames from a film",
        camera: { angle: "low dynamic angle", shot: "wide tracking shot", lens: "24mm", aperture: "f/8", iso: "100", focus: "Sharp focus on car with motion blur on background", model: "shot on Sony A7R IV with a 24-70mm f/2.8 zoom lens" },
        lighting: "golden hour lighting, warm sunlight, long shadows, soft golden glow",
        colors: { palette: ["#1C1C1C", "#39FF14", "#FF8C00", "#A0522D"], mood: "intense atmosphere, dramatic mood, powerful emotion, high stakes feeling" },
        composition: "diagonal composition, dynamic lines, sense of movement and energy"
      },
      macro: {
        prompt: "A close-up macro shot of a honeybee landing delicately on a sunflower's center, pollen clinging to its legs, with extreme detail in the insect's compound eyes and wing veins, set against a shallow depth-of-field background of blurred yellow petals and bokeh sunlight, showcasing biological realism and lighting interaction.",
        style: "macro photography, extreme close-ups, intricate details, unseen worlds, capturing texture, emphasizing details, revealing beauty in small things, professional lighting, precise focusing, artistic expression, immersive experience, expert technique",
        camera: { angle: "extreme close-up", shot: "macro detail", lens: "100mm macro", aperture: "f/5.6", iso: "200", focus: "Tack sharp on bee's compound eyes, focus stacked", model: "shot on Canon EOS R5 with a 24-70mm f/2.8 zoom lens" },
        lighting: "dappled sunlight through leaves, natural light patterns, forest lighting",
        colors: { palette: ["#DAA520", "#FFD700", "#1C1C1C", "#F0E68C"], mood: "dreamy atmosphere, ethereal quality, soft and magical, otherworldly feeling" },
        composition: "fill the frame composition, tight crop, subject dominates image"
      },
      culinary: {
        prompt: "A chef in a crisp white uniform with navy apron ties flips a sizzling pancake mid-air in a professional stainless-steel kitchen, steam rising from the griddle, dynamic motion blur on the pancake, and accurate specular highlights on metal surfaces, all under warm, directional overhead lighting that casts realistic soft shadows.",
        style: "food photography, mouthwatering dishes, vibrant colors, appetizing presentations, enticing compositions, delicious details, showcasing textures, capturing freshness, professional lighting, expert styling, culinary storytelling, enhancing food appeal",
        camera: { angle: "slightly low", shot: "action medium shot", lens: "35mm", aperture: "f/4", iso: "800", focus: "Sharp on chef, slight motion blur on pancake", model: "shot on Sony A7 IV with a 35mm f/1.4 G Master lens" },
        lighting: "three-point lighting setup, key light, fill light, back light, professional studio",
        colors: { palette: ["#FFFFFF", "#000080", "#C0C0C0", "#FFD700"], mood: "joyful mood, vibrant energy, celebratory atmosphere, lively spirit" },
        composition: "action composition, motion blur, dynamic movement, peak moment"
      },
      theatrical: {
        prompt: "A dancer in a flowing crimson dress leaps mid-air in a grand baroque theater, stage lights casting dramatic chiaroscuro across her muscles and fabric, with dynamic motion trails, accurate joint articulation, and intricate details in the gilded balconies and velvet curtains in the background.",
        style: "fine art photography, conceptual expression, evocative imagery, artistic interpretation, emotional resonance, creative composition, professional lighting, exquisite detail, immersive experience, storytelling through imagery, conveying mood, unique perspective, thought-provoking concept, capturing beauty, transcending reality",
        camera: { angle: "low angle", shot: "full body action", lens: "70mm", aperture: "f/2.8", iso: "1600", focus: "Sharp on dancer with background slightly soft", model: "shot on Canon EOS R5 with a 24-70mm f/2.8 zoom lens" },
        lighting: "chiaroscuro lighting, dramatic contrast between light and dark, Renaissance style",
        colors: { palette: ["#DC143C", "#FFD700", "#722F37", "#FFFFFF"], mood: "intense atmosphere, dramatic mood, powerful emotion, high stakes feeling" },
        composition: "centered composition, symmetrical balance, formal arrangement"
      },
      architectural: {
        prompt: "A modernist concrete museum with sweeping curves and geometric cutouts floats above a reflecting pool at blue hour, interior warm lighting visible through floor-to-ceiling windows, with perfect symmetry and leading lines drawing the eye toward the dramatic cantilever.",
        style: "architecture photography, striking structures, clean lines, geometric shapes, dramatic angles, play of light and shadow, capturing architectural details, showcasing design elements, evoking mood, professional lighting, precise compositions, emphasizing scale and proportion, creating depth, architectural storytelling, capturing iconic landmarks, immersive experience",
        camera: { angle: "eye level", shot: "wide shot", lens: "24mm", aperture: "f/11", iso: "100", focus: "Deep focus throughout, everything sharp", model: "shot on Nikon Z7 II with a 35mm f/1.8 lens" },
        lighting: "blue hour lighting, soft twilight, cool blue tones, ambient glow",
        colors: { palette: ["#808080", "#1E3A5F", "#FFB347", "#C0C0C0"], mood: "serene atmosphere, peaceful mood, calm tranquility, meditative feeling" },
        composition: "centered composition, symmetrical balance, formal arrangement"
      },
      cinematic: {
        prompt: "A lone figure in a trench coat walks down a rain-soaked alley in 1940s Los Angeles, neon signs flickering through the mist, harsh shadows from a single street lamp cutting across the wet pavement, venetian blind shadows on the brick wall, the entire scene bathed in moody film noir atmosphere with rich blacks and selective highlights.",
        style: "Cinematic photography, movie mood, cinematic light, compelling composition, storytelling elements, conveys emotion, mood, and narrative depth, creating visually striking images that feel like still frames from a film",
        camera: { angle: "low angle", shot: "wide shot", lens: "35mm", aperture: "f/2.8", iso: "800", focus: "Deep focus, everything sharp with atmospheric depth", model: "shot on Sony A7S III with a 24mm f/1.4 low-light lens" },
        lighting: "film noir lighting, hard shadows, venetian blind shadows, dramatic black and white mood",
        colors: { palette: ["#0D0D0D", "#39FF14", "#4A4A4A", "#FF8C00"], mood: "film noir mood, black and white contrast, shadowy mystery, detective atmosphere" },
        composition: "leading lines composition, lines guide viewer's eye to subject"
      },
      vintage: {
        prompt: "A young couple sharing a milkshake at a classic 1950s American diner, chrome barstools and checkered floor tiles, warm tungsten lighting reflecting off the jukebox, soft focus and subtle film grain evoking the nostalgic warmth of Kodachrome, authentic period clothing and hairstyles.",
        style: "experimental photography, pushing the boundaries of creativity, unconventional techniques, innovative concepts, artistic exploration, thought-provoking imagery, pushing the boundaries of traditional photography",
        camera: { angle: "eye level", shot: "medium shot", lens: "50mm", aperture: "f/2.8", iso: "400", focus: "Soft focus on couple, dreamy quality", model: "shot on Fujifilm X-T5 with a 23mm f/1.4 lens, classic chrome film simulation" },
        lighting: "tungsten lighting, warm orange indoor light, cozy interior atmosphere",
        colors: { palette: ["#C0C0C0", "#DC143C", "#1C1C1C", "#FFB347"], mood: "vintage mood, nostalgic atmosphere, retro aesthetic, timeless feeling" },
        composition: "environmental portrait composition, subject in context, story-telling background"
      },
      minimalist: {
        prompt: "A single red umbrella resting against a stark white wall, dramatic shadow stretching across the pristine surface, extreme negative space emphasizing the solitary object, clean geometric lines and perfect color contrast creating a striking visual statement.",
        style: "fine art photography, conceptual expression, evocative imagery, artistic interpretation, emotional resonance, creative composition, professional lighting, exquisite detail, immersive experience, storytelling through imagery, conveying mood, unique perspective, thought-provoking concept, capturing beauty, transcending reality",
        camera: { angle: "straight on", shot: "medium shot", lens: "50mm", aperture: "f/8", iso: "100", focus: "Sharp throughout, graphic quality", model: "shot on Leica Q2 with its 28mm f/1.7 Summilux lens" },
        lighting: "high key lighting, bright and airy, minimal shadows, clean white background",
        colors: { palette: ["#FFFFFF", "#DC143C", "#696969", "#F5F5F5"], mood: "minimalist zen mood, calm atmosphere, simple aesthetic, mindful presence" },
        composition: "negative space composition, minimalist, subject with breathing room"
      },
      underwater: {
        prompt: "A graceful sea turtle gliding through crystal-clear turquoise waters, sunbeams penetrating from the surface creating god rays, colorful coral reef in the background, tiny fish swimming alongside, the turtle's ancient textured shell and wise eyes in perfect detail.",
        style: "landscape photography, vast vistas, natural beauty, dynamic compositions, captivating scenery, immersive, serene",
        camera: { angle: "slightly low", shot: "medium shot", lens: "16mm", aperture: "f/8", iso: "400", focus: "Sharp on turtle, reef softly blurred", model: "shot on Sony A7 IV with a 35mm f/1.4 G Master lens" },
        lighting: "underwater lighting, caustic light patterns, blue-green filtered sunlight",
        colors: { palette: ["#40E0D0", "#FF7F50", "#8B4513", "#FFD700"], mood: "serene atmosphere, peaceful mood, calm tranquility, meditative feeling" },
        composition: "rule of thirds composition, subject off-center, balanced visual weight"
      },
      nsfw: {
        prompt: "A sensual artistic nude figure bathed in warm golden light from a nearby window, soft shadows caressing natural curves, silk sheets pooling around the form, intimate bedroom setting with luxurious textures, tasteful composition emphasizing the beauty of the human form, professional fine art aesthetic with careful attention to lighting and shadow play.",
        style: "fine art photography, conceptual expression, evocative imagery, artistic interpretation, emotional resonance, creative composition, professional lighting, exquisite detail, immersive experience, storytelling through imagery, conveying mood, unique perspective, thought-provoking concept, capturing beauty, transcending reality",
        camera: { angle: "eye level", shot: "medium shot", lens: "85mm", aperture: "f/1.8", iso: "200", focus: "Sharp on subject, creamy background bokeh, soft skin rendering", model: "shot on Sony A7 IV with an 85mm f/1.4 G Master portrait lens" },
        lighting: "natural window light, soft directional lighting, gentle shadows",
        colors: { palette: ["#F5DEB3", "#FFE4C4", "#D4A574", "#8B4513", "#1C1C1C"], mood: "sensual mood, intimate atmosphere, passionate feeling, artistic expression" },
        composition: "artistic nude composition, curves and shadows, tasteful framing, fine art aesthetic"
      }
    };

    // DOM elements
    const promptInput = document.getElementById('prompt');
    const styleInput = document.getElementById('style');
    const cameraAngle = document.getElementById('camera-angle');
    const cameraShot = document.getElementById('camera-shot');
    const cameraLens = document.getElementById('camera-lens');
    const cameraAperture = document.getElementById('camera-aperture');
    const cameraISO = document.getElementById('camera-iso');
    const cameraFocus = document.getElementById('camera-focus');
    const cameraModel = document.getElementById('camera-model');
    const lightingInput = document.getElementById('lighting');
    const colorPalette = document.getElementById('color-palette');
    const colorMood = document.getElementById('color-mood');
    const moodDropdown = document.getElementById('mood-dropdown');
    const moodSelector = document.getElementById('mood-selector');
    const moodEditToggle = document.getElementById('mood-edit-toggle');
    const compositionInput = document.getElementById('composition');
    const compositionDropdown = document.getElementById('composition-dropdown');
    const compositionSelector = document.getElementById('composition-selector');
    const compositionEditToggle = document.getElementById('composition-edit-toggle');
    const addColorBtn = document.getElementById('add-color');
    const jsonOutput = document.getElementById('json-output');
    const copyBtn = document.getElementById('copy-btn');
    const presetSelect = document.getElementById('preset-select');
    const includeEmpty = document.getElementById('include-empty');
    const numericLens = document.getElementById('numeric-lens');
    const styleDropdown = document.getElementById('style-dropdown');
    const styleSelector = document.getElementById('style-selector');
    const styleEditToggle = document.getElementById('style-edit-toggle');
    const cameraDropdown = document.getElementById('camera-dropdown');
    const cameraSelector = document.getElementById('camera-selector');
    const cameraEditToggle = document.getElementById('camera-edit-toggle');
    const lightingDropdown = document.getElementById('lighting-dropdown');
    const lightingSelector = document.getElementById('lighting-selector');
    const lightingEditToggle = document.getElementById('lighting-edit-toggle');

    // Style presets from styles.csv
    const stylePresets = {
      "Photography": [
        { name: "Aerial", prompt: "aerial photography, drone photography, sweeping landscapes, unique perspectives, epic scale, capturing from above, revealing hidden beauty, showcasing vastness, immersive experience, precise compositions, expert piloting, dynamic angles, cinematic storytelling, showcasing natural wonders, aerial exploration" },
        { name: "Architecture", prompt: "architecture photography, striking structures, clean lines, geometric shapes, dramatic angles, play of light and shadow, capturing architectural details, showcasing design elements, evoking mood, professional lighting, precise compositions, emphasizing scale and proportion, creating depth, architectural storytelling, capturing iconic landmarks, immersive experience" },
        { name: "Black and White", prompt: "black and white photography, timeless elegance, classic aesthetic, dramatic contrasts, emphasizing shapes and textures, evoking nostalgia, focusing on light and shadow, monochromatic storytelling, capturing mood and emotion, artistic expression, minimalist compositions, conveying depth and atmosphere, timeless beauty" },
        { name: "Cinematic", prompt: "Cinematic photography, movie mood, cinematic light, compelling composition, storytelling elements, conveys emotion, mood, and narrative depth, creating visually striking images that feel like still frames from a film" },
        { name: "Documentary", prompt: "documentary photography, capturing reality, social issues, human experiences, photojournalistic storytelling, candid moments, authentic narratives, raising awareness, documenting history, preserving cultural heritage, immersive storytelling, evoking empathy, powerful imagery, journalistic integrity" },
        { name: "Experimental", prompt: "experimental photography, pushing the boundaries of creativity, unconventional techniques, innovative concepts, artistic exploration, thought-provoking imagery, pushing the boundaries of traditional photography" },
        { name: "Fashion", prompt: "fashion photography, glamorous, stylish attire, captivating pose, dynamic composition, high-fashion aesthetic, professional studio lighting, expert styling, showcasing trend, conveying elegance, conveying attitude, evoking emotion, creating visual impact, editorial storytelling, artistic interpretation, fashion-forward visual" },
        { name: "Fashion Editorial", prompt: "fashion editorial photography, high-fashion imagery, avant-garde aesthetics, editorial storytelling, conveying fashion trends and concepts, artistic interpretation, expert styling, professional lighting, capturing fashion-forward visuals, creating visual impact, evoking emotion, pushing creative boundaries" },
        { name: "Fine Art", prompt: "fine art photography, conceptual expression, evocative imagery, artistic interpretation, emotional resonance, creative composition, professional lighting, exquisite detail, immersive experience, storytelling through imagery, conveying mood, unique perspective, thought-provoking concept, capturing beauty, transcending reality" },
        { name: "Food", prompt: "food photography, mouthwatering dishes, vibrant colors, appetizing presentations, enticing compositions, delicious details, showcasing textures, capturing freshness, professional lighting, expert styling, culinary storytelling, enhancing food appeal" },
        { name: "Landscape", prompt: "landscape photography, vast vistas, natural beauty, dynamic compositions, captivating scenery, immersive, serene" },
        { name: "Long Exposure", prompt: "long exposure photography, streaking lights, smooth motion, dreamy landscapes, ethereal atmosphere, light painting, creative expression, time manipulation, surreal effects, captivating visuals, artistic interpretation, immersive experience, unique perspective" },
        { name: "Low Key", prompt: "low key photography, dramatic lighting, deep shadows, rich contrast, moody atmosphere, intense emotions, cinematic feel, mysterious ambiance, emphasizing shape and form, creating depth, evoking drama, storytelling through shadows, professional technique" },
        { name: "Macro", prompt: "macro photography, extreme close-ups, intricate details, unseen worlds, capturing texture, emphasizing details, revealing beauty in small things, professional lighting, precise focusing, artistic expression, immersive experience, expert technique" },
        { name: "Minimalist", prompt: "minimalist photography, simplicity in composition, clean lines, uncluttered visuals, negative space, focusing on essential elements, conveying tranquility, understated beauty, elegant aesthetics, subtle storytelling, capturing the essence of minimalism" },
        { name: "Night", prompt: "night photography, nocturnal beauty, city lights, starry skies, celestial wonders, moonlit landscapes, urban glow, capturing the essence of darkness, ethereal atmosphere, dramatic shadows, magical ambiance, long exposure techniques, expert use of light sources" },
        { name: "Portrait", prompt: "portrait photography, capturing emotion, personality, flattering lighting, professional, engaging, compelling composition" },
        { name: "Portrait Cinematic", prompt: "Cinematic portrait photography, capture subject in a way that resembles a still frame from a movie, cinematic lighting, story, narrative quality, drawing viewers into the scene and evoking a sense of cinematic immersion, capturing emotion, professional, engaging, compelling composition" },
        { name: "Portrait Closeup", prompt: "closeup portrait photography, beautiful eyes, capturing emotion, personality, flattering lighting, professional, engaging, compelling composition" },
        { name: "Portrait Fantasy", prompt: "fantasy portrait photography, beautiful eyes, ethereal beauty, magical atmosphere, whimsical element, enchanting composition, mystical storytelling, professional lighting, imaginative concept, creative styling, otherworldly aesthetic, fantasy romance, surreal visual, enchanting character, captivating narrative, intricate detail, vibrant color, fantastical landscape" },
        { name: "Product", prompt: "product photography, crisp details, clean composition, attention to detail, professional lighting, precise focus, appealing aesthetics, capturing textures, high-quality imagery, commercial appeal, creative presentation" },
        { name: "Sport", prompt: "sport photography, action-packed moment, dynamic, intense competition, thrilling movement, showcasing skill, conveying energy, adrenaline-fueled visuals, immersive experience, storytelling through action, dramatic composition, showcasing passion, capturing decisive moments, vibrant colors, dynamic composition, powerful imagery, engaging perspective" },
        { name: "Still Life", prompt: "still life photography, capturing tranquility, timeless beauty, meticulous arrangement, exquisite detail, professional lighting, expert composition, evocative mood, storytelling through objects, artistic interpretation, creative expression, showcasing textures, intricate patterns, enhancing atmosphere, conveying emotions, masterful technique, immersive experience" },
        { name: "Surreal", prompt: "surreal photography, dreamlike imagery, subconscious exploration, bending reality, imaginative narratives, juxtaposing elements, evoking wonder and awe, transcending boundaries, challenging perceptions, fantastical landscapes, otherworldly atmospheres" },
        { name: "Underwater", prompt: "underwater photography, otherworldly landscape, unique perspective, ethereal lighting, dynamic composition, captivating underwater scene, immersive, serene, expert lighting technique, breathtaking moment captured" },
        { name: "Vintage", prompt: "vintage photography, nostalgic charm, timeless appeal, old-world aesthetics, classic elegance, warm tones, soft focus, aged textures, evoking nostalgia, historical ambiance, storytelling through imagery, vintage atmosphere, timeless compositions, authentic vintage look, professional technique" },
        { name: "Wildlife", prompt: "wildlife photography, capturing nature's beauty, breathtaking landscapes, immersive experience, storytelling through imagery, showcasing wildlife behavior, sharp details, evocative composition, unique perspective" }
      ],
      "Painting": [
        { name: "Abstract Expressionism", prompt: "Abstract Expressionism art style, emphasizes spontaneous and gestural brushwork, explores emotions and inner thoughts, non-representational and subjective, influenced by the subconscious and the act of painting itself" },
        { name: "Acrylic", prompt: "Acrylic Paint art style, fast-drying paint, versatile, vibrant colors, expressive brushwork, rich textures, dynamic compositions, bold contrasts, layered depth, tactile quality, fluid movement, lively energy, immersive atmosphere, professional-grade finish" },
        { name: "Chinese Ink Brush", prompt: "Chinese ink brush art style, graceful brushwork, elegant compositions, traditional motifs, professional-grade execution, captures the essence of Chinese culture and aesthetics" },
        { name: "Digital", prompt: "Digital painting art style, dynamic composition, professional-grade execution" },
        { name: "Fantasy Art", prompt: "Fantasy painting art style, imaginative, dynamic composition, professional-grade execution, creates immersive world and landscape, painterly, epic, magical" },
        { name: "Gouache", prompt: "gouache painting style, gouache opaque colors, matte finish, vibrant hues, dynamic compositions, professional-grade result, adds depth and texture" },
        { name: "Graffiti", prompt: "Graffiti aerosol painting art style, bold composition, vibrant colors, mural, urban aesthetic, hip hop culture" },
        { name: "Impasto", prompt: "impasto painting art style, thick and textured brushwork, vibrant colors, tactile quality, expressive strokes, dynamic compositions, bold contrasts, dramatic lighting effects, immersive texture, professional-grade finish, adds depth and dimension, creates visual interest" },
        { name: "Impressionism", prompt: "Impressionism painting art style, loose brushwork, captures the fleeting effects of light and atmosphere" },
        { name: "Oil Painting", prompt: "oil painting art style, rich colors, lush textures, expressive brushwork, blendable layers, dynamic compositions, professional-grade finish, versatile medium, timeless elegance, immersive depth, vibrant hues, intricate detailing, adds depth and dimension" },
        { name: "Renaissance", prompt: "oil painting art style from Renaissance period, masterful composition, Renaissance mood, renaissance oil painting, brush strokes" },
        { name: "Sumi-e", prompt: "Sumi-e painting style, traditional Japanese ink wash painting, emphasizes simplicity and elegance, expressive brushwork, captures the essence of the subject with minimal strokes, meditative and reflective" },
        { name: "Watercolor", prompt: "Watercolor painting art style, transparent and delicate layers, luminous and ethereal effects, spontaneous and fluid compositions, subtle gradients and blending, captures light and atmosphere, creates soft and dreamy scenes" }
      ],
      "Illustration": [
        { name: "Anime", prompt: "anime art style, anime digital art, expressive anime art, dynamic composition, anime style, vibrant, studio anime, highly detailed" },
        { name: "Anime Chibi", prompt: "Chibi anime art style, cute and exaggerated characters, large heads and small bodies, expressive facial features, playful and whimsical, popular in manga and anime fandoms" },
        { name: "Anime Kawaii", prompt: "Kawaii anime art style, cute, adorable characters with big eyes and small mouths, pastel colors, playful and endearing" },
        { name: "Anime Realistic", prompt: "Realistic anime art style, combines anime aesthetics with lifelike details, detailed character designs, intricate backgrounds, immersive storytelling" },
        { name: "Art Deco", prompt: "Art Deco illustration style, elegant and geometric designs, streamlined and symmetrical compositions, embodies the glamour and sophistication of the Art Deco era, influenced by modernism and machine aesthetics" },
        { name: "Cartoon", prompt: "Cartoon illustration style, whimsical and expressive characters, exaggerated features and emotions, versatile and adaptable for various storytelling purposes" },
        { name: "Children's Book", prompt: "Children's book illustration style, whimsical and charming imagery, bright and playful colors, engaging characters and storytelling, cartoon" },
        { name: "Fantasy", prompt: "Fantasy illustration style, transports viewers to imaginative worlds, epic landscape, and heroic adventures, sparks wonder and inspiration" },
        { name: "Fashion", prompt: "Fashion illustration style, captures the latest trends and designs in clothing and accessories, elegant and stylized figures, showcases creativity and imagination in the fashion industry" },
        { name: "Game Art", prompt: "Game art illustration style, game illustration, diverse and immersive visuals, whimsical, dynamic characters and environments, rich color palettes, enhances storytelling and gameplay experience" },
        { name: "Pop Art", prompt: "Pop art illustration style, vibrant and bold colors, uses imagery from popular culture, incorporate elements of mass media and consumerism, celebrates the mundane and everyday objects" },
        { name: "Retro", prompt: "Retro illustration style, nostalgic and vintage aesthetics, inspired by design elements from past decades, evokes a sense of nostalgia and charm" }
      ],
      "Drawing": [
        { name: "Charcoal", prompt: "charcoal drawing style, dramatic contrast, expressive strokes, rich textures, dynamic composition, professional-grade finish, classic aesthetic" },
        { name: "Colored Pencil", prompt: "Colored pencil drawing art style, vibrant colors, delicate shading, professional-grade execution, captures the richness and depth of traditional drawing techniques" },
        { name: "Graphite", prompt: "graphite drawing art style, subtle tones, delicate shading, precise detailing, fine textures, expressive lines, intricate compositions, timeless elegance, professional-grade finish, immersive depth, classic aesthetic" },
        { name: "Ink", prompt: "Ink drawing art style, bold lines, expressive strokes, high contrast, intricate details, dynamic compositions, versatile medium, professional-grade finish, classic aesthetic, adds depth and texture, timeless elegance" },
        { name: "Pastel", prompt: "pastel drawing art style, pastel colors, delicate shading, dynamic composition, soft and velvety pastel textures, amazing pastel drawing" },
        { name: "Pencil", prompt: "Pencil drawing art style, delicate shading, precise lines, professional-grade execution, captures the subtlety and texture of graphite" }
      ],
      "3D": [
        { name: "Abstract", prompt: "abstract 3D render, abstract 3d art, imaginative design, dynamic lighting, immersive presentation, captivating visuals, high-quality rendering techniques, innovative concept, unique aesthetics, creative compositions, visually stunning results, volumetric, 4k" },
        { name: "Abstract Fluid", prompt: "fluid dynamics 3D art style, 3d fluid render, expressive and dynamic, vibrant contrasting colors, lively appearance, mesmerizing flow of shapes, simulation of fluid dynamics, swirling motion, bold colors blending seamlessly, abstract and captivating, fluidity and energy, mesmerizing composition, engaging viewer experience, seamless integration of colors and shapes, volumetric, 4k" },
        { name: "Architectural", prompt: "professional 3D architectural rendering, realistic visualization, intricate detailing, lifelike textures, dynamic lighting, immersive environment, photorealistic representation, captivating visuals, realistic materials, professional rendering techniques, volumetric, 4k" },
        { name: "Character", prompt: "professional 3D character design, dynamic pose, expert character design, engaging storytelling, captivating visuals, imaginative concept, high-quality rendering, volumetric, 4k" }
      ]
    };

    // Populate style dropdown
    function populateStyleDropdown() {
      styleDropdown.innerHTML = '<option value="">‚Äî Select a style ‚Äî</option>';

      for (const [category, styles] of Object.entries(stylePresets)) {
        const optgroup = document.createElement('optgroup');
        optgroup.label = category;

        styles.forEach(style => {
          const option = document.createElement('option');
          option.value = style.prompt;
          option.textContent = style.name;
          optgroup.appendChild(option);
        });

        styleDropdown.appendChild(optgroup);
      }
    }

    // Initialize style dropdown
    populateStyleDropdown();

    // Style dropdown change handler
    styleDropdown.addEventListener('change', (e) => {
      styleInput.value = e.target.value;
      updateOutput();
    });

    // Style edit toggle handler
    styleEditToggle.addEventListener('click', () => {
      styleSelector.classList.toggle('edit-mode');
      if (styleSelector.classList.contains('edit-mode')) {
        styleInput.focus();
      }
    });

    // Sync dropdown when text input changes (if value matches a preset)
    styleInput.addEventListener('input', () => {
      // Try to find matching preset
      let found = false;
      for (const styles of Object.values(stylePresets)) {
        const match = styles.find(s => s.prompt === styleInput.value);
        if (match) {
          styleDropdown.value = match.prompt;
          found = true;
          break;
        }
      }
      if (!found) {
        styleDropdown.value = '';
      }
      updateOutput();
    });

    // Camera presets from camera2.json
    const cameraPresets = {
      "Canon": [
        { name: "EOS 5D Mark IV + 35mm f/1.4", prompt: "shot on Canon EOS 5D Mark IV with a 35mm f/1.4 lens" },
        { name: "EOS 5D Mark IV + 50mm f/1.2", prompt: "shot on Canon EOS 5D Mark IV with a 50mm f/1.2 lens" },
        { name: "EOS R5 + 24-70mm f/2.8", prompt: "shot on Canon EOS R5 with a 24-70mm f/2.8 zoom lens" },
        { name: "EOS R5 + 85mm f/1.2", prompt: "shot on Canon EOS R5 with an 85mm f/1.2 portrait lens" },
        { name: "EOS R6 Mark II + 35mm f/1.8", prompt: "shot on Canon EOS R6 Mark II with a 35mm f/1.8 lens" }
      ],
      "Nikon": [
        { name: "D850 + 24-70mm f/2.8", prompt: "shot on Nikon D850 with a 24-70mm f/2.8 zoom lens" },
        { name: "D850 + 85mm f/1.4", prompt: "shot on Nikon D850 with an 85mm f/1.4 portrait lens" },
        { name: "Z7 II + 35mm f/1.8", prompt: "shot on Nikon Z7 II with a 35mm f/1.8 lens" },
        { name: "Z8 + 50mm f/1.2", prompt: "shot on Nikon Z8 with a 50mm f/1.2 lens" }
      ],
      "Sony": [
        { name: "A7 IV + 35mm f/1.4 GM", prompt: "shot on Sony A7 IV with a 35mm f/1.4 G Master lens" },
        { name: "A7 IV + 85mm f/1.4 GM", prompt: "shot on Sony A7 IV with an 85mm f/1.4 G Master portrait lens" },
        { name: "A7R IV + 24-70mm f/2.8 GM", prompt: "shot on Sony A7R IV with a 24-70mm f/2.8 zoom lens" },
        { name: "A7S III + 24mm f/1.4 GM", prompt: "shot on Sony A7S III with a 24mm f/1.4 low-light lens" },
        { name: "Alpha 1 + 50mm f/1.2 GM", prompt: "shot on Sony Alpha 1 with a 50mm f/1.2 G Master lens" }
      ],
      "Fujifilm": [
        { name: "X-T5 + 23mm f/1.4", prompt: "shot on Fujifilm X-T5 with a 23mm f/1.4 lens, classic chrome film simulation" },
        { name: "X-H2S + 16-55mm f/2.8", prompt: "shot on Fujifilm X-H2S with a 16-55mm f/2.8 zoom lens" },
        { name: "GFX 100S + 80mm f/1.7", prompt: "shot on Fujifilm GFX 100S with an 80mm f/1.7 medium-format portrait lens" }
      ],
      "Leica": [
        { name: "M10 + 35mm f/1.4 Summilux", prompt: "shot on Leica M10 with a 35mm f/1.4 Summilux lens" },
        { name: "Q2 + 28mm f/1.7", prompt: "shot on Leica Q2 with its 28mm f/1.7 Summilux lens" }
      ],
      "Hasselblad": [
        { name: "X1D II 50C + 65mm f/2.8", prompt: "shot on Hasselblad X1D II 50C with a 65mm f/2.8 medium-format lens" }
      ],
      "Phase One": [
        { name: "XF IQ4 + 80mm f/2.8", prompt: "shot on Phase One XF IQ4 with an 80mm f/2.8 medium-format lens" }
      ],
      "Panasonic": [
        { name: "Lumix S5 II + 24-105mm f/4", prompt: "shot on Panasonic Lumix S5 II with a 24-105mm f/4 lens" },
        { name: "Lumix GH6 + 12-35mm f/2.8", prompt: "shot on Panasonic GH6 with a 12-35mm f/2.8 MFT lens" }
      ],
      "Other Cameras": [
        { name: "Pentax K-1 II + 31mm f/1.8", prompt: "shot on Pentax K-1 Mark II with a 31mm f/1.8 Limited lens" },
        { name: "OM System E-M1 III + 17mm f/1.2", prompt: "shot on OM-D E-M1 Mark III with a 17mm f/1.2 PRO lens" },
        { name: "Ricoh GR III", prompt: "shot on Ricoh GR III with its fixed 28mm equivalent f/2.8 lens" },
        { name: "Sony RX100 VII", prompt: "shot on Sony RX100 VII with its 24-200mm equivalent zoom lens" }
      ],
      "Smartphones": [
        { name: "iPhone 15 Pro", prompt: "shot on iPhone 15 Pro, 24mm main camera, computational photography" },
        { name: "Samsung Galaxy S24 Ultra", prompt: "shot on Samsung Galaxy S24 Ultra main wide camera" }
      ],
      "Film Stocks": [
        { name: "Kodak Portra 400", prompt: "shot on Kodak Portra 400 film, warm tones, fine grain" },
        { name: "Kodak Portra 800", prompt: "shot on Kodak Portra 800 film, versatile color negative" },
        { name: "Kodak Ektar 100", prompt: "shot on Kodak Ektar 100 film, vivid colors, fine grain" },
        { name: "Kodak Gold 200", prompt: "shot on Kodak Gold 200 film, warm nostalgic tones" },
        { name: "Fujifilm Pro 400H", prompt: "shot on Fujifilm Pro 400H film, soft pastel colors" },
        { name: "Fujifilm Superia 400", prompt: "shot on Fujifilm Superia 400 film, classic consumer film look" },
        { name: "Cinestill 800T", prompt: "shot on Cinestill 800T film, cinematic tungsten-balanced, halation effect" },
        { name: "Ilford HP5 Plus", prompt: "shot on Ilford HP5 Plus black and white film, classic grain" },
        { name: "Kodak Tri-X 400", prompt: "shot on Kodak Tri-X 400 black and white film, iconic contrast" },
        { name: "Ilford Delta 3200", prompt: "shot on Ilford Delta 3200 black and white film, dramatic grain" }
      ]
    };

    // Populate camera dropdown
    function populateCameraDropdown() {
      cameraDropdown.innerHTML = '<option value="">‚Äî Select camera/lens ‚Äî</option>';

      for (const [category, cameras] of Object.entries(cameraPresets)) {
        const optgroup = document.createElement('optgroup');
        optgroup.label = category;

        cameras.forEach(camera => {
          const option = document.createElement('option');
          option.value = camera.prompt;
          option.textContent = camera.name;
          optgroup.appendChild(option);
        });

        cameraDropdown.appendChild(optgroup);
      }
    }

    // Initialize camera dropdown
    populateCameraDropdown();

    // Camera dropdown change handler
    cameraDropdown.addEventListener('change', (e) => {
      cameraModel.value = e.target.value;
      updateOutput();
    });

    // Camera edit toggle handler
    cameraEditToggle.addEventListener('click', () => {
      cameraSelector.classList.toggle('edit-mode');
      if (cameraSelector.classList.contains('edit-mode')) {
        cameraModel.focus();
      }
    });

    // Sync camera dropdown when text input changes (if value matches a preset)
    cameraModel.addEventListener('input', () => {
      let found = false;
      for (const cameras of Object.values(cameraPresets)) {
        const match = cameras.find(c => c.prompt === cameraModel.value);
        if (match) {
          cameraDropdown.value = match.prompt;
          found = true;
          break;
        }
      }
      if (!found) {
        cameraDropdown.value = '';
      }
      updateOutput();
    });

    // Lighting presets
    const lightingPresets = {
      "Natural Light": [
        { name: "Golden Hour", prompt: "golden hour lighting, warm sunlight, long shadows, soft golden glow" },
        { name: "Blue Hour", prompt: "blue hour lighting, soft twilight, cool blue tones, ambient glow" },
        { name: "Harsh Midday Sun", prompt: "harsh midday sunlight, strong shadows, high contrast, direct overhead sun" },
        { name: "Overcast / Diffused", prompt: "overcast sky, soft diffused natural light, no harsh shadows, even illumination" },
        { name: "Window Light", prompt: "natural window light, soft directional lighting, gentle shadows" },
        { name: "Backlit / Rim Light", prompt: "backlit subject, rim lighting, sun behind subject, glowing edges, lens flare" },
        { name: "Dappled Light", prompt: "dappled sunlight through leaves, natural light patterns, forest lighting" },
        { name: "Sunrise", prompt: "sunrise lighting, warm orange and pink tones, low angle sunlight, morning atmosphere" },
        { name: "Sunset", prompt: "sunset lighting, warm red and orange tones, dramatic sky, evening atmosphere" },
        { name: "Moonlight", prompt: "moonlight illumination, cool blue tones, nighttime ambiance, soft silver light" }
      ],
      "Studio Lighting": [
        { name: "Three-Point Lighting", prompt: "three-point lighting setup, key light, fill light, back light, professional studio" },
        { name: "Softbox", prompt: "softbox lighting, soft diffused light, minimal shadows, even skin tones" },
        { name: "Ring Light", prompt: "ring light, even facial illumination, circular catchlights in eyes, beauty lighting" },
        { name: "Beauty Dish", prompt: "beauty dish lighting, soft yet contrasty, wraparound light, fashion photography" },
        { name: "Butterfly Lighting", prompt: "butterfly lighting, paramount lighting, shadow under nose, glamour portrait style" },
        { name: "Rembrandt Lighting", prompt: "Rembrandt lighting, triangle of light on cheek, dramatic portrait lighting" },
        { name: "Split Lighting", prompt: "split lighting, half face illuminated, dramatic contrast, moody portrait" },
        { name: "Broad Lighting", prompt: "broad lighting, lit side of face toward camera, flattering portrait light" },
        { name: "Short Lighting", prompt: "short lighting, shadow side toward camera, slimming effect, dramatic mood" },
        { name: "Clamshell Lighting", prompt: "clamshell lighting, beauty lighting from above and below, soft glamour look" }
      ],
      "Dramatic & Cinematic": [
        { name: "Chiaroscuro", prompt: "chiaroscuro lighting, dramatic contrast between light and dark, Renaissance style" },
        { name: "Low Key", prompt: "low key lighting, predominantly dark tones, dramatic shadows, moody atmosphere" },
        { name: "High Key", prompt: "high key lighting, bright and airy, minimal shadows, clean white background" },
        { name: "Film Noir", prompt: "film noir lighting, hard shadows, venetian blind shadows, dramatic black and white mood" },
        { name: "Neon Lights", prompt: "neon lighting, vibrant colored lights, cyberpunk aesthetic, urban night scene" },
        { name: "Volumetric Light", prompt: "volumetric lighting, god rays, light beams through atmosphere, dramatic shafts of light" },
        { name: "Silhouette", prompt: "silhouette lighting, backlit subject, dark figure against bright background" },
        { name: "Practical Lights", prompt: "practical lighting, visible light sources in scene, natural movie set lighting" },
        { name: "Motivated Lighting", prompt: "motivated lighting, light appears to come from realistic sources in scene" }
      ],
      "Color & Creative": [
        { name: "Colored Gels", prompt: "colored gel lighting, creative color effects, dramatic colored shadows" },
        { name: "RGB Lighting", prompt: "RGB LED lighting, multicolored illumination, gaming aesthetic, modern creative" },
        { name: "Cross Lighting", prompt: "cross lighting, two lights from opposite sides, dimensional look, textured" },
        { name: "Accent Lighting", prompt: "accent lighting, highlighting specific areas, dramatic emphasis, spot lighting" },
        { name: "Warm and Cool Mix", prompt: "mixed warm and cool lighting, color contrast, orange and blue tones" },
        { name: "Candlelight", prompt: "candlelight illumination, warm flickering glow, intimate romantic atmosphere" },
        { name: "Firelight", prompt: "firelight illumination, warm orange glow, dancing shadows, cozy atmosphere" },
        { name: "Fairy Lights / Bokeh", prompt: "fairy lights, string lights bokeh, magical sparkle, dreamy atmosphere" }
      ],
      "Environmental": [
        { name: "Street Lights", prompt: "street light illumination, urban night lighting, pools of light, city atmosphere" },
        { name: "Fluorescent", prompt: "fluorescent lighting, cool greenish tint, office or industrial setting" },
        { name: "Tungsten / Incandescent", prompt: "tungsten lighting, warm orange indoor light, cozy interior atmosphere" },
        { name: "Mixed Ambient", prompt: "mixed ambient lighting, multiple light sources, natural indoor environment" },
        { name: "Stage Lighting", prompt: "stage lighting, dramatic spotlights, performance lighting, theatrical" },
        { name: "Car Headlights", prompt: "car headlight illumination, harsh directional beams, nighttime road scene" },
        { name: "Underwater Light", prompt: "underwater lighting, caustic light patterns, blue-green filtered sunlight" }
      ]
    };

    // Populate lighting dropdown
    function populateLightingDropdown() {
      lightingDropdown.innerHTML = '<option value="">‚Äî Select lighting ‚Äî</option>';

      for (const [category, lights] of Object.entries(lightingPresets)) {
        const optgroup = document.createElement('optgroup');
        optgroup.label = category;

        lights.forEach(light => {
          const option = document.createElement('option');
          option.value = light.prompt;
          option.textContent = light.name;
          optgroup.appendChild(option);
        });

        lightingDropdown.appendChild(optgroup);
      }
    }

    // Initialize lighting dropdown
    populateLightingDropdown();

    // Lighting dropdown change handler
    lightingDropdown.addEventListener('change', (e) => {
      lightingInput.value = e.target.value;
      updateOutput();
    });

    // Lighting edit toggle handler
    lightingEditToggle.addEventListener('click', () => {
      lightingSelector.classList.toggle('edit-mode');
      if (lightingSelector.classList.contains('edit-mode')) {
        lightingInput.focus();
      }
    });

    // Sync lighting dropdown when text input changes (if value matches a preset)
    lightingInput.addEventListener('input', () => {
      let found = false;
      for (const lights of Object.values(lightingPresets)) {
        const match = lights.find(l => l.prompt === lightingInput.value);
        if (match) {
          lightingDropdown.value = match.prompt;
          found = true;
          break;
        }
      }
      if (!found) {
        lightingDropdown.value = '';
      }
      updateOutput();
    });

    // Mood presets
    const moodPresets = {
      "Emotional Tones": [
        { name: "Moody & Atmospheric", prompt: "moody atmosphere, emotional depth, contemplative feeling, evocative imagery" },
        { name: "Dreamy & Ethereal", prompt: "dreamy atmosphere, ethereal quality, soft and magical, otherworldly feeling" },
        { name: "Melancholic", prompt: "melancholic mood, wistful atmosphere, bittersweet emotion, nostalgic sadness" },
        { name: "Joyful & Vibrant", prompt: "joyful mood, vibrant energy, celebratory atmosphere, lively spirit" },
        { name: "Mysterious", prompt: "mysterious atmosphere, enigmatic mood, intriguing shadows, sense of wonder" },
        { name: "Serene & Peaceful", prompt: "serene atmosphere, peaceful mood, calm tranquility, meditative feeling" },
        { name: "Intense & Dramatic", prompt: "intense atmosphere, dramatic mood, powerful emotion, high stakes feeling" },
        { name: "Romantic", prompt: "romantic mood, intimate atmosphere, tender emotion, love and passion" }
      ],
      "Visual Aesthetics": [
        { name: "Cinematic", prompt: "cinematic mood, movie-like atmosphere, dramatic visual storytelling" },
        { name: "Vintage & Nostalgic", prompt: "vintage mood, nostalgic atmosphere, retro aesthetic, timeless feeling" },
        { name: "Modern & Sleek", prompt: "modern aesthetic, sleek and contemporary, minimalist mood, clean design" },
        { name: "Gritty & Raw", prompt: "gritty atmosphere, raw aesthetic, unpolished texture, street-style mood" },
        { name: "Elegant & Luxurious", prompt: "elegant mood, luxurious atmosphere, refined aesthetic, sophisticated feel" },
        { name: "Whimsical & Playful", prompt: "whimsical mood, playful atmosphere, fun and quirky, lighthearted energy" },
        { name: "Dark & Gothic", prompt: "dark gothic mood, shadowy atmosphere, macabre aesthetic, mysterious elegance" },
        { name: "Bright & Airy", prompt: "bright and airy mood, light atmosphere, fresh and open, uplifting feeling" }
      ],
      "Environmental Moods": [
        { name: "Urban Elegance", prompt: "urban elegance, city sophistication, metropolitan mood, stylish street atmosphere" },
        { name: "Natural & Organic", prompt: "natural mood, organic atmosphere, earthy aesthetic, connection to nature" },
        { name: "Industrial", prompt: "industrial mood, urban decay aesthetic, raw textures, gritty atmosphere" },
        { name: "Coastal & Breezy", prompt: "coastal mood, ocean breeze atmosphere, seaside feeling, relaxed vibes" },
        { name: "Forest & Woodland", prompt: "forest atmosphere, woodland mood, natural greenery, enchanted feeling" },
        { name: "Desert & Arid", prompt: "desert mood, arid atmosphere, warm earth tones, vast open space" },
        { name: "Winter & Cold", prompt: "winter mood, cold atmosphere, crisp and frozen, quiet stillness" },
        { name: "Tropical & Lush", prompt: "tropical mood, lush atmosphere, vibrant greenery, exotic paradise" }
      ],
      "Stylistic Moods": [
        { name: "Film Noir", prompt: "film noir mood, black and white contrast, shadowy mystery, detective atmosphere" },
        { name: "Sci-Fi Futuristic", prompt: "sci-fi mood, futuristic atmosphere, technological aesthetic, cyberpunk vibes" },
        { name: "Fantasy & Magical", prompt: "fantasy mood, magical atmosphere, enchanted aesthetic, mythical feeling" },
        { name: "Retro 80s", prompt: "retro 80s mood, synthwave atmosphere, neon aesthetic, vintage futurism" },
        { name: "Bohemian", prompt: "bohemian mood, free-spirited atmosphere, artistic aesthetic, eclectic vibes" },
        { name: "Minimalist Zen", prompt: "minimalist zen mood, calm atmosphere, simple aesthetic, mindful presence" }
      ]
    };

    // Composition presets
    const compositionPresets = {
      "Classic Rules": [
        { name: "Rule of Thirds", prompt: "rule of thirds composition, subject off-center, balanced visual weight" },
        { name: "Golden Ratio", prompt: "golden ratio composition, fibonacci spiral, naturally pleasing proportions" },
        { name: "Golden Triangle", prompt: "golden triangle composition, diagonal lines, dynamic balance" },
        { name: "Centered / Symmetrical", prompt: "centered composition, symmetrical balance, formal arrangement" },
        { name: "Diagonal", prompt: "diagonal composition, dynamic lines, sense of movement and energy" },
        { name: "L-Shaped", prompt: "L-shaped composition, elements form L pattern, stable yet dynamic" }
      ],
      "Leading & Framing": [
        { name: "Leading Lines", prompt: "leading lines composition, lines guide viewer's eye to subject" },
        { name: "Frame Within Frame", prompt: "frame within frame composition, natural border around subject" },
        { name: "Tunnel / Archway", prompt: "tunnel composition, archway framing, depth through opening" },
        { name: "Foreground Interest", prompt: "foreground interest composition, layered depth, near and far elements" },
        { name: "Through Window", prompt: "through window composition, view framed by window, indoor-outdoor connection" }
      ],
      "Spatial Techniques": [
        { name: "Negative Space", prompt: "negative space composition, minimalist, subject with breathing room" },
        { name: "Fill the Frame", prompt: "fill the frame composition, tight crop, subject dominates image" },
        { name: "Deep Depth", prompt: "deep depth composition, foreground, midground, background layers" },
        { name: "Flat / 2D", prompt: "flat composition, two-dimensional aesthetic, graphic quality" },
        { name: "Bird's Eye View", prompt: "bird's eye view composition, overhead perspective, pattern emphasis" },
        { name: "Worm's Eye View", prompt: "worm's eye view composition, low angle looking up, dramatic perspective" }
      ],
      "Dynamic Compositions": [
        { name: "Dynamic Tension", prompt: "dynamic tension composition, contrasting elements, visual conflict" },
        { name: "Radial", prompt: "radial composition, elements radiating from center, circular movement" },
        { name: "S-Curve", prompt: "S-curve composition, flowing curved lines, graceful movement" },
        { name: "Triangular", prompt: "triangular composition, three points of interest, stable arrangement" },
        { name: "Juxtaposition", prompt: "juxtaposition composition, contrasting elements side by side, visual comparison" },
        { name: "Layered", prompt: "layered composition, multiple planes of depth, complex visual hierarchy" }
      ],
      "Special Purpose": [
        { name: "Portrait Close-up", prompt: "portrait composition, face fills frame, intimate connection, eye contact" },
        { name: "Environmental Portrait", prompt: "environmental portrait composition, subject in context, story-telling background" },
        { name: "Landscape Panoramic", prompt: "panoramic landscape composition, wide vista, horizontal emphasis" },
        { name: "Product Centered", prompt: "product composition, item centered, clean background, commercial appeal" },
        { name: "Action / Motion", prompt: "action composition, motion blur, dynamic movement, peak moment" },
        { name: "Candid / Documentary", prompt: "candid composition, unposed moment, authentic documentary style" }
      ]
    };

    // Populate mood dropdown
    function populateMoodDropdown() {
      moodDropdown.innerHTML = '<option value="">‚Äî Select mood ‚Äî</option>';

      for (const [category, moods] of Object.entries(moodPresets)) {
        const optgroup = document.createElement('optgroup');
        optgroup.label = category;

        moods.forEach(mood => {
          const option = document.createElement('option');
          option.value = mood.prompt;
          option.textContent = mood.name;
          optgroup.appendChild(option);
        });

        moodDropdown.appendChild(optgroup);
      }
    }

    // Populate composition dropdown
    function populateCompositionDropdown() {
      compositionDropdown.innerHTML = '<option value="">‚Äî Select composition ‚Äî</option>';

      for (const [category, compositions] of Object.entries(compositionPresets)) {
        const optgroup = document.createElement('optgroup');
        optgroup.label = category;

        compositions.forEach(comp => {
          const option = document.createElement('option');
          option.value = comp.prompt;
          option.textContent = comp.name;
          optgroup.appendChild(option);
        });

        compositionDropdown.appendChild(optgroup);
      }
    }

    // Initialize mood and composition dropdowns
    populateMoodDropdown();
    populateCompositionDropdown();

    // Mood dropdown change handler
    moodDropdown.addEventListener('change', (e) => {
      colorMood.value = e.target.value;
      updateOutput();
    });

    // Mood edit toggle handler
    moodEditToggle.addEventListener('click', () => {
      moodSelector.classList.toggle('edit-mode');
      if (moodSelector.classList.contains('edit-mode')) {
        colorMood.focus();
      }
    });

    // Sync mood dropdown when text input changes
    colorMood.addEventListener('input', () => {
      let found = false;
      for (const moods of Object.values(moodPresets)) {
        const match = moods.find(m => m.prompt === colorMood.value);
        if (match) {
          moodDropdown.value = match.prompt;
          found = true;
          break;
        }
      }
      if (!found) {
        moodDropdown.value = '';
      }
      updateOutput();
    });

    // Composition dropdown change handler
    compositionDropdown.addEventListener('change', (e) => {
      compositionInput.value = e.target.value;
      updateOutput();
    });

    // Composition edit toggle handler
    compositionEditToggle.addEventListener('click', () => {
      compositionSelector.classList.toggle('edit-mode');
      if (compositionSelector.classList.contains('edit-mode')) {
        compositionInput.focus();
      }
    });

    // Sync composition dropdown when text input changes
    compositionInput.addEventListener('input', () => {
      let found = false;
      for (const compositions of Object.values(compositionPresets)) {
        const match = compositions.find(c => c.prompt === compositionInput.value);
        if (match) {
          compositionDropdown.value = match.prompt;
          found = true;
          break;
        }
      }
      if (!found) {
        compositionDropdown.value = '';
      }
      updateOutput();
    });

    // Setup combo dropdowns
    document.querySelectorAll('.dropdown-toggle').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const menuId = btn.dataset.target;
        const menu = document.getElementById(menuId);
        
        // Close all other menus
        document.querySelectorAll('.dropdown-menu').forEach(m => {
          if (m.id !== menuId) m.classList.remove('open');
        });
        
        menu.classList.toggle('open');
      });
    });

    document.querySelectorAll('.dropdown-menu .option').forEach(opt => {
      opt.addEventListener('click', () => {
        const menu = opt.closest('.dropdown-menu');
        const input = menu.previousElementSibling.previousElementSibling;
        input.value = opt.dataset.value;
        menu.classList.remove('open');
        updateOutput();
      });
    });

    // Close dropdowns on outside click
    document.addEventListener('click', () => {
      document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.remove('open'));
    });

    // Check if EyeDropper API is supported (requires secure context: HTTPS or localhost)
    const eyeDropperSupported = 'EyeDropper' in window && window.isSecureContext;

    // SVG icon for eye dropper
    const eyeDropperIcon = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="m2 22 1-1h3l9-9"/>
      <path d="M3 21v-3l9-9"/>
      <path d="m15 6 3.4-3.4a2.1 2.1 0 1 1 3 3L18 9l.4.4a2.1 2.1 0 1 1-3 3l-3.8-3.8a2.1 2.1 0 1 1 3-3l.4.4Z"/>
    </svg>`;

    // Render colors
    function renderColors() {
      colorPalette.innerHTML = '';
      colors.forEach((color, index) => {
        const chip = document.createElement('div');
        chip.className = 'color-chip';

        const isHex = color.startsWith('#');
        const eyeDropperTitle = eyeDropperSupported
          ? 'Pick color from screen'
          : 'Eye dropper requires HTTPS or localhost';

        chip.innerHTML = `
          <input type="color" value="${isHex ? color : '#888888'}" data-index="${index}" title="Pick a color">
          <button class="eyedropper-btn" data-index="${index}" title="${eyeDropperTitle}" ${!eyeDropperSupported ? 'disabled' : ''}>${eyeDropperIcon}</button>
          <input type="text" value="${color}" data-index="${index}" placeholder="Color name or hex">
          <button class="remove-btn" data-index="${index}">√ó</button>
        `;
        colorPalette.appendChild(chip);
      });

      // Add event listeners for text inputs
      colorPalette.querySelectorAll('input[type="text"]').forEach(input => {
        input.addEventListener('input', (e) => {
          const index = parseInt(e.target.dataset.index);
          colors[index] = e.target.value;
          updateColorPicker(e.target, e.target.value);
          updateOutput();
        });
      });

      // Add event listeners for color pickers
      colorPalette.querySelectorAll('input[type="color"]').forEach(picker => {
        picker.addEventListener('input', (e) => {
          const index = parseInt(e.target.dataset.index);
          const hexValue = e.target.value;
          colors[index] = hexValue;
          // Update the text input
          const textInput = e.target.parentElement.querySelector('input[type="text"]');
          textInput.value = hexValue;
          updateOutput();
        });
      });

      // Add event listeners for eye dropper buttons
      colorPalette.querySelectorAll('.eyedropper-btn').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          if (!eyeDropperSupported) return;

          const index = parseInt(e.target.dataset.index);
          try {
            const eyeDropper = new EyeDropper();
            const result = await eyeDropper.open();
            const hexValue = result.sRGBHex;
            colors[index] = hexValue;
            renderColors();
            updateOutput();
          } catch (err) {
            // User cancelled or error occurred
            console.log('EyeDropper cancelled or failed:', err);
          }
        });
      });

      colorPalette.querySelectorAll('.remove-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const index = parseInt(e.target.dataset.index);
          colors.splice(index, 1);
          renderColors();
          updateOutput();
        });
      });
    }

    function updateColorPicker(textInput, value) {
      const colorPicker = textInput.parentElement.querySelector('input[type="color"]');
      if (value.startsWith('#') && (value.length === 4 || value.length === 7)) {
        colorPicker.value = value.length === 4
          ? '#' + value[1] + value[1] + value[2] + value[2] + value[3] + value[3]
          : value;
      }
    }

    // Generate JSON
    function generateJSON() {
      const shouldIncludeEmpty = includeEmpty.checked;
      const useNumericLens = numericLens.checked;

      const data = {};

      // Add fields conditionally
      if (promptInput.value || shouldIncludeEmpty) data.prompt = promptInput.value;
      if (styleInput.value || shouldIncludeEmpty) data.style = styleInput.value;

      // Camera object
      const camera = {};
      if (cameraAngle.value || shouldIncludeEmpty) camera.angle = cameraAngle.value;
      if (cameraShot.value || shouldIncludeEmpty) camera.distance = cameraShot.value;
      
      // Lens handling
      if (cameraLens.value || shouldIncludeEmpty) {
        if (useNumericLens) {
          const lensMatch = cameraLens.value.match(/(\d+)/);
          if (lensMatch) {
            camera['lens-mm'] = parseInt(lensMatch[1]);
          } else {
            camera.lens = cameraLens.value;
          }
        } else {
          camera.lens = cameraLens.value;
        }
      }

      if (cameraAperture.value || shouldIncludeEmpty) camera['f-number'] = cameraAperture.value;
      if (cameraISO.value || shouldIncludeEmpty) {
        const isoNum = parseInt(cameraISO.value);
        camera.ISO = isNaN(isoNum) ? cameraISO.value : isoNum;
      }
      if (cameraFocus.value || shouldIncludeEmpty) camera.focus = cameraFocus.value;
      
      if (Object.keys(camera).length > 0 || shouldIncludeEmpty) data.camera = camera;

      // Film stock as separate field
      if (cameraModel.value) data.film_stock = cameraModel.value;

      // Lighting
      if (lightingInput.value || shouldIncludeEmpty) data.lighting = lightingInput.value;

      // Colors
      const filteredColors = colors.filter(c => c.trim() !== '');
      if (filteredColors.length > 0 || colorMood.value || shouldIncludeEmpty) {
        data.colors = {};
        if (filteredColors.length > 0 || shouldIncludeEmpty) data.colors.palette = filteredColors;
        if (colorMood.value || shouldIncludeEmpty) data.colors.mood = colorMood.value;
      }

      // Composition
      if (compositionInput.value || shouldIncludeEmpty) data.composition = compositionInput.value;

      return data;
    }

    // Syntax highlight JSON
    function highlightJSON(json) {
      const str = JSON.stringify(json, null, 2);
      return str
        .replace(/"([^"]+)":/g, '<span class="key">"$1"</span>:')
        .replace(/: "([^"]*)"/g, ': <span class="string">"$1"</span>')
        .replace(/: (\d+)/g, ': <span class="number">$1</span>');
    }

    // Update output
    function updateOutput() {
      const json = generateJSON();
      jsonOutput.innerHTML = highlightJSON(json);
    }

    // Load preset
    function loadPreset(preset) {
      if (!preset) return;

      promptInput.value = preset.prompt || '';
      styleInput.value = preset.style || '';

      // Sync style dropdown
      let styleFound = false;
      for (const styles of Object.values(stylePresets)) {
        const match = styles.find(s => s.prompt === preset.style);
        if (match) {
          styleDropdown.value = match.prompt;
          styleFound = true;
          break;
        }
      }
      if (!styleFound) {
        styleDropdown.value = '';
      }
      // Exit edit mode when loading preset
      styleSelector.classList.remove('edit-mode');

      cameraAngle.value = preset.camera?.angle || '';
      cameraShot.value = preset.camera?.shot || '';
      cameraLens.value = preset.camera?.lens || '';
      cameraAperture.value = preset.camera?.aperture || '';
      cameraISO.value = preset.camera?.iso || '';
      cameraFocus.value = preset.camera?.focus || '';
      cameraModel.value = preset.camera?.model || '';

      // Sync camera dropdown
      let cameraFound = false;
      for (const cameras of Object.values(cameraPresets)) {
        const match = cameras.find(c => c.prompt === cameraModel.value);
        if (match) {
          cameraDropdown.value = match.prompt;
          cameraFound = true;
          break;
        }
      }
      if (!cameraFound) {
        cameraDropdown.value = '';
      }
      // Exit edit mode when loading preset
      cameraSelector.classList.remove('edit-mode');

      lightingInput.value = preset.lighting || '';

      // Sync lighting dropdown
      let lightingFound = false;
      for (const lights of Object.values(lightingPresets)) {
        const match = lights.find(l => l.prompt === lightingInput.value);
        if (match) {
          lightingDropdown.value = match.prompt;
          lightingFound = true;
          break;
        }
      }
      if (!lightingFound) {
        lightingDropdown.value = '';
      }
      // Exit edit mode when loading preset
      lightingSelector.classList.remove('edit-mode');

      colors = preset.colors?.palette ? [...preset.colors.palette] : [];
      colorMood.value = preset.colors?.mood || '';

      // Sync mood dropdown
      let moodFound = false;
      for (const moods of Object.values(moodPresets)) {
        const match = moods.find(m => m.prompt === colorMood.value);
        if (match) {
          moodDropdown.value = match.prompt;
          moodFound = true;
          break;
        }
      }
      if (!moodFound) {
        moodDropdown.value = '';
      }
      // Exit edit mode when loading preset
      moodSelector.classList.remove('edit-mode');

      compositionInput.value = preset.composition || '';

      // Sync composition dropdown
      let compositionFound = false;
      for (const compositions of Object.values(compositionPresets)) {
        const match = compositions.find(c => c.prompt === compositionInput.value);
        if (match) {
          compositionDropdown.value = match.prompt;
          compositionFound = true;
          break;
        }
      }
      if (!compositionFound) {
        compositionDropdown.value = '';
      }
      // Exit edit mode when loading preset
      compositionSelector.classList.remove('edit-mode');

      renderColors();
      updateOutput();
    }

    // Event listeners
    addColorBtn.addEventListener('click', () => {
      colors.push('');
      renderColors();
      const inputs = colorPalette.querySelectorAll('input');
      inputs[inputs.length - 1].focus();
    });

    const allInputs = [
      promptInput, cameraAngle, cameraShot, cameraLens,
      cameraAperture, cameraISO, cameraFocus
    ];

    allInputs.forEach(el => {
      el.addEventListener('input', updateOutput);
      el.addEventListener('change', updateOutput);
    });

    [includeEmpty, numericLens].forEach(el => {
      el.addEventListener('change', updateOutput);
    });

    presetSelect.addEventListener('change', (e) => {
      const presetName = e.target.value;
      if (presetName && presets[presetName]) {
        loadPreset(presets[presetName]);
      }
    });

    copyBtn.addEventListener('click', () => {
      const json = generateJSON();
      const text = JSON.stringify(json, null, 2);
      navigator.clipboard.writeText(text).then(() => {
        copyBtn.textContent = 'Copied!';
        copyBtn.classList.add('copied');
        setTimeout(() => {
          copyBtn.textContent = 'Copy to Clipboard';
          copyBtn.classList.remove('copied');
        }, 2000);
      });
    });

    // ==========================================
    // Image-based Color Picker (Canvas Mode)
    // ==========================================

    // Image picker elements
    let imageDropZone, imageInput, imageCanvas, canvasCtx;
    let clearImageBtn, pickedColorPreview, previewSwatch, previewHex;
    let currentPickedColor = null;

    function initImagePicker() {
      // Get DOM elements
      imageDropZone = document.getElementById('image-drop-zone');
      imageInput = document.getElementById('image-input');
      imageCanvas = document.getElementById('image-canvas');
      clearImageBtn = document.getElementById('clear-image');
      pickedColorPreview = document.getElementById('picked-color-preview');
      previewSwatch = document.getElementById('preview-swatch');
      previewHex = document.getElementById('preview-hex');

      // Initialize canvas context
      canvasCtx = imageCanvas.getContext('2d', { willReadFrequently: true });

      // Click to upload
      imageDropZone.addEventListener('click', (e) => {
        // Don't trigger file input if clicking on canvas or clear button
        if (e.target === imageCanvas || e.target === clearImageBtn) return;
        if (!imageDropZone.classList.contains('has-image')) {
          imageInput.click();
        }
      });

      // File input change
      imageInput.addEventListener('change', (e) => {
        if (e.target.files && e.target.files[0]) {
          loadImageToCanvas(e.target.files[0]);
        }
      });

      // Drag and drop handlers
      imageDropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        e.stopPropagation();
        imageDropZone.classList.add('drag-over');
      });

      imageDropZone.addEventListener('dragleave', (e) => {
        e.preventDefault();
        e.stopPropagation();
        imageDropZone.classList.remove('drag-over');
      });

      imageDropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        e.stopPropagation();
        imageDropZone.classList.remove('drag-over');

        const files = e.dataTransfer.files;
        if (files && files[0] && files[0].type.startsWith('image/')) {
          loadImageToCanvas(files[0]);
        }
      });

      // Clear image button
      clearImageBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        clearImage();
      });

      // Canvas click to pick color (auto-adds to palette)
      imageCanvas.addEventListener('click', (e) => {
        pickColorFromCanvas(e);
      });

      // Canvas mousemove to preview color
      imageCanvas.addEventListener('mousemove', (e) => {
        previewColorFromCanvas(e);
      });
    }

    function loadImageToCanvas(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
          // Calculate dimensions to fit within max constraints
          const maxWidth = imageDropZone.clientWidth - 4; // Account for border
          const maxHeight = 300;

          let width = img.width;
          let height = img.height;

          // Scale down if needed
          if (width > maxWidth) {
            height = (maxWidth / width) * height;
            width = maxWidth;
          }
          if (height > maxHeight) {
            width = (maxHeight / height) * width;
            height = maxHeight;
          }

          // Set canvas size
          imageCanvas.width = width;
          imageCanvas.height = height;

          // Draw image
          canvasCtx.drawImage(img, 0, 0, width, height);

          // Update UI state
          imageDropZone.classList.add('has-image');
          pickedColorPreview.classList.add('visible');
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function clearImage() {
      // Clear canvas
      canvasCtx.clearRect(0, 0, imageCanvas.width, imageCanvas.height);
      imageCanvas.width = 0;
      imageCanvas.height = 0;

      // Reset file input
      imageInput.value = '';

      // Update UI state
      imageDropZone.classList.remove('has-image');
      pickedColorPreview.classList.remove('visible');
      currentPickedColor = null;
    }

    function getCanvasColorAt(e) {
      const rect = imageCanvas.getBoundingClientRect();
      const scaleX = imageCanvas.width / rect.width;
      const scaleY = imageCanvas.height / rect.height;

      const x = Math.floor((e.clientX - rect.left) * scaleX);
      const y = Math.floor((e.clientY - rect.top) * scaleY);

      // Get pixel data
      const pixel = canvasCtx.getImageData(x, y, 1, 1).data;

      // Convert to hex
      const hex = '#' +
        pixel[0].toString(16).padStart(2, '0') +
        pixel[1].toString(16).padStart(2, '0') +
        pixel[2].toString(16).padStart(2, '0');

      return hex.toUpperCase();
    }

    function previewColorFromCanvas(e) {
      if (!imageDropZone.classList.contains('has-image')) return;

      const hex = getCanvasColorAt(e);
      previewSwatch.style.backgroundColor = hex;
      previewHex.textContent = hex;
    }

    function pickColorFromCanvas(e) {
      if (!imageDropZone.classList.contains('has-image')) return;

      currentPickedColor = getCanvasColorAt(e);
      previewSwatch.style.backgroundColor = currentPickedColor;
      previewHex.textContent = currentPickedColor;

      // Auto-add to palette on click
      colors.push(currentPickedColor);
      renderColors();
      updateOutput();

      // Visual feedback - flash the preview
      pickedColorPreview.style.borderColor = '#7c3aed';
      setTimeout(() => {
        pickedColorPreview.style.borderColor = '#3a3a3a';
      }, 200);
    }

    // Initialize
    initImagePicker();
    renderColors();
    updateOutput();
  </script>
</body>
</html>
